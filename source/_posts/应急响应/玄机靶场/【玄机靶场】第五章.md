---
title: 【玄机靶场】第五章
categories:
  - 应急响应
  - 玄机靶场
tags:
  - private
description: >-
  声明：文章中涉及的程序(方法)可能带有攻击性，仅供安全研究与教学之用，读者将其信息做其他用途，由用户承担全部法律及连带责任，文章作者不承担任何法律及连带责任。
comments: true
abbrlink: f8c9cd7b
date: 2025-09-04 06:41:38
top:
---

黑客干了啥：

添加了新的网站管理员：通过数据库改回密码

![image-20250904145340898](【玄机靶场】第五章/image-20250904145340898.png)

![image-20250904152435789](【玄机靶场】第五章/image-20250904152435789.png)





应急响应：

1. 查看最近访问频率高的IP，根据流量特征确定恶意IP，进行封禁
2. 修改配置文件，临时禁止向文件上传路径传文件

3. 检查最近创建的文件，查找黑客上传的后门，发现php后缀的木马文件。备份方便下一步分析，然后删除
4. 日志和流量包，追踪黑客木马路径的流量包，发现蚁剑的流量特征
5. 分析流量包：
   1. 查看了敏感文件，
   2. 黑客对服务器的php文件进行了修改，代码中添加了后门，和开发沟通进行修复
   3. 读取了`config.inc.php`，并使用连接了数据库。立即修改数据库的密码，并且通知管理员修改密码
   4. 宝塔开起了Binlog   或  通过后续的流量分析，发现使用数据库添加了网站管理员。删除

6. 对文件上传漏洞修复

问题：

1. 后门一般通过什么方式知道
2. 服务器没有找到木马文件，连接关闭后是不是会删除
3. 后门连接shell后，进入mysql执行查询语句，语句是不是也能在流量包中解析
4. 后面的包是加密的，不知道怎么说。



渗透测试的时候遇到了文件上传漏洞

Web服务器用户对网站文件只有读和执行权限，对上传目录只有写权限，通过路径遍历绕过到了上一层

连接后门之后，发现有其他的后门文件

查看这个后门文件，创建时间将近一个月前

他们有巡检设备，但是配置有问题，这个站没有防护上



通知甲方把密码都给改了、这个危害比较大，能改的都改了（系统密码、SSH秘钥、数据库密码、网站后台密码）

根据后门路径，检查日志，查看攻击者IP和访问时间

查到这些IP两三天内有大量访问

检查一个月内时间里创建的可疑文件，还有这段时间内改动的服务器文件，跟开发沟通，确认哪些是有问题的，并进行修复

立刻进行基线排查（定时任务、检查进程和网络连接、计划任务、用户和SSH密钥）

河马进行扫描，删除其他后门，修复服务器代码（）

历史命令已清理

























查看历史命令，针对历史命令，看黑客进行了哪些行为并修复。

查看流量包，看黑客进行了哪些行为



1. 查看了数据库配置脚本



flag1

```bash
grep "Accepted " /var/log/secure | awk '{print $11}'
```

![image-20250904144432880](【玄机靶场】第五章/image-20250904144432880.png)

## 修改了网站管理员的密码

1. 通过数据库连接文件（`config.inc.php`）查看数据库的查看数据库的密码

   





修改数据库密码、网站管理员密码

增加防护





本文参考：
