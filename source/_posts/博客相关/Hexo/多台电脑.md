---
categories:
  - 博客相关
  - Hexo
abbrlink: '0'
---
# 多台电脑协同管理Hexo博客完全指南

本文详细介绍了如何使用 **Git双分支策略**，在多个Windows电脑间无缝同步和管理一个Hexo博客。该方法能确保写作环境一致、源文件安全，并实现流畅的跨设备协作。

------

## 核心策略：Git双分支

我们采用双分支来分离关注点：

- **`hexo`分支 (或 `source` 分支)**：存放博客的**所有源文件**（文章、配置、主题、插件等）。此分支用于在多台电脑间同步和协作。
- **`main` 分支 (或 `master` 分支)**：存放Hexo生成的**静态网站文件**（即 `public/` 文件夹内容）。此分支专门用于部署到GitHub Pages等托管服务。

**核心原则**：源文件 (`hexo` 分支) 与生成网站 (`main` 分支) 完全分离。

------

## 一、首次设置与迁移（从一台旧电脑开始）

假设你已在旧电脑上拥有一个本地Hexo博客。

### 1. 准备远程仓库

- 在GitHub上创建一个新仓库，仓库名必须为：`<你的用户名>.github.io`。
- 创建后，在GitHub网页上手动新建一个名为 `hexo` 的分支。

### 2. 配置本地Hexo项目

1. **修改主配置文件 `_config.yml`**
   用编辑器打开博客根目录下的 `_config.yml`，至少确认以下两部分：

   yaml

   ```
   # a) 部署设置 (deploy)
   deploy:
     type: git
     repo: https://github.com/你的用户名/你的用户名.github.io.git # 或使用SSH地址
     branch: main # 确保部署到 main 分支
   
   # b) 主题设置 (theme)，例如：
   theme: next
   ```

   

2. **安装必要插件**
   在博客根目录执行：

   bash

   ```
   npm install
   npm install hexo-deployer-git --save
   # 如果使用Next等主题，可能需要安装对应的渲染器，例如：
   npm install hexo-renderer-stylus --save
   ```

   

### 3. 初始化本地Git仓库并连接远程

bash

```
# 进入博客根目录
cd your-blog-folder
# 初始化本地仓库
git init
# 创建并切换到 hexo 分支
git checkout -b hexo
# 添加远程仓库地址
git remote add origin https://github.com/你的用户名/你的用户名.github.io.git
```



### 4. 配置`.gitignore`文件

在博客根目录创建 `.gitignore` 文件，确保以下内容不被提交：

gitignore

```
# 依赖
node_modules/

# 生成文件
public/
.deploy*/

# 日志和数据库
*.log
db.json

# 环境文件
.env

# 系统文件
.DS_Store
Thumbs.db
```



### 5. 处理主题子模块问题（关键步骤）

如果您的主题（如Next）是通过 `git clone` 安装的，其目录内会包含 `.git` 文件夹，导致文件无法被主仓库跟踪。

- **原因**：Git会将其识别为“子模块”，忽略其内容，导致其他电脑拉取后主题目录为空。

- **解决方案**：安全删除主题文件夹内的 `.git` 文件/文件夹。

  bash

  ```
  # 以 Next 主题为例，在博客根目录执行：
  find themes/next -name ".git" -type f -o -name ".git" -type d | while read f; do rm -rf "$f"; echo "已清理: $f"; done
  ```

  

  **⚠️ 警告**：此操作仅针对 `themes/xxx/` 目录！**切勿删除**博客项目根目录下的 `.git` 文件夹。

### 6. 配置SSH密钥并提交（每台电脑只需一次）

bash

```
# 1. 生成SSH密钥（使用ed25519算法）
ssh-keygen -t ed25519 -C "your_email@example.com"
# 生成过程中，连续按三次回车（接受默认路径，设置空密码）

# 2. 启动代理并添加密钥
eval "$(ssh-agent -s)"
ssh-add ~/.ssh/id_ed25519

# 3. 复制公钥并添加到GitHub
cat ~/.ssh/id_ed25519.pub
# 复制输出内容，登录GitHub，在 Settings -> SSH and GPG keys 中添加新密钥。

# 4. 测试连接
ssh -T git@github.com
# 显示成功认证信息即可。

# 5. （重要）将本地仓库远程地址改为SSH格式
git remote set-url origin git@github.com:你的用户名/你的用户名.github.io.git

# 6. 验证
git remote -v
```



### 7. 提交源文件并首次部署

bash

```
# 提交所有源文件到本地仓库
git add .
git commit -m "初始化：提交Hexo博客所有源文件"
# 推送到远程 hexo 分支
git push origin hexo

# 生成静态网站并部署到 main 分支
hexo clean && hexo g -d
```



至此，`hexo` 分支已保存所有源码，`main` 分支已部署网站。

------

## 二、新电脑加入协作

在新电脑上，你需要克隆源码并恢复环境。

### 1. 安装基础环境

- **Node.js**（推荐LTS版，如v18.x/20.x，所有电脑版本尽量一致）
- **Git**
- **Hexo CLI** (`npm install -g hexo-cli`)

### 2. 克隆源码并恢复环境

bash

```
# 克隆 hexo 分支（注意 -b 参数）
git clone -b hexo git@github.com:你的用户名/你的用户名.github.io.git
# 进入项目目录
cd 你的用户名.github.io

# 注意：不要执行 hexo init！
# 直接安装项目所需依赖
npm install
```



### 3. 测试运行

bash

```
hexo clean
hexo g
hexo s
```



访问 `http://localhost:4000` 预览正常，则新电脑环境配置成功。

------

## 三、日常双机同步工作流（黄金法则）

将远程 `hexo` 分支视为 **“唯一真相源”**。任何修改前必须同步，修改后必须立即推送。

### 开始工作前（在任何电脑上）

bash

```
# 1. 进入博客目录
cd /你的/博客/路径

# 2. （可选）保存未提交的临时更改
git add .
git commit -m “临时存档：开始新工作前”

# 3. 【关键】拉取远程最新内容
git pull origin hexo

# 4. 处理结果：
#    - 若显示 “Already up to date.”: 本地已最新，可开始工作。
#    - 若显示 “CONFLICT”: 发现冲突，立即停止，跳转到【冲突解决】部分。
```



### 完成工作后（在任何电脑上）



```bash
# 1. （推荐）本地预览，确保无误
hexo clean && hexo g && hexo s
# 按 Ctrl+C 停止预览服务器

# 2. 提交源码到本地仓库
git add .
git commit -m “描述你的更改，例如：发布文章《XXX》”

# 3. 推送源码到远程“真相源”
git push origin hexo

# 4. 生成并部署网站
hexo clean && hexo g -d
```



------

## 四、依赖同步与修复命令集（解决环境问题）

请严格按以下流程操作，**先旧电脑，后新电脑**：

### **第一步：在旧电脑（正常工作的电脑）上更新依赖清单**

在旧电脑的博客根目录执行：

bash

```
# 生成/更新 package-lock.json，记录所有依赖的确切版本
npm install --package-lock-only

# 提交这两个描述依赖的关键文件
git add package.json package-lock.json
git commit -m “更新：提交精确的依赖锁定文件”
git push origin hexo
```



### **第二步：在新电脑（报错的电脑）上强制同步并重建依赖**

在旧电脑完成推送后，立即在新电脑执行：

bash

```
# 1. 拉取旧电脑刚刚推送的更新
git pull origin hexo

# 2. 【关键】彻底删除现有的 node_modules 和缓存
rm -rf node_modules
hexo clean

# 3. 根据 package-lock.json 安装完全一致的依赖
npm ci

# 4. 验证
hexo g
hexo s
```



### 命令解析

- **`npm install --package-lock-only`**：不实际安装，只根据当前 `node_modules` 更新 `package-lock.json`（依赖的“精确清单”）。
- **`npm ci`**：根据 `package-lock.json` 安装依赖，**能保证环境完全一致**，比 `npm install` 更严格、更快。

如果问题依旧，检查主题文件夹是否完整同步：

bash

```
# 在新电脑上检查主题文件是否存在
ls themes/next/scripts/tags/
```



如果文件缺失，需返回旧电脑，确保整个主题文件夹已提交（无内嵌 `.git`），然后重新推送和同步。

------

## 五、常见问题与排查

1. **新电脑克隆后 `hexo s` 失败**

   - **原因**：克隆了 `main` 分支而非 `hexo` 分支。
   - **解决**：使用 `git clone -b hexo <仓库地址>` 重新克隆。

2. **页面样式错乱或加载慢**

   - **原因**：主题配置使用外部CDN，或主题本地资源缺失。
   - **解决**：
     1. 在主题配置 (`themes/你的主题/_config.yml`) 中将资源引用改为 `local`。
     2. 确认已安装主题所需渲染器。
     3. 执行 `hexo clean` 并强制刷新浏览器 (`Ctrl + F5`)。

3. **同步后新电脑内容未更新**

   bash

   ```
   # 强制重置到远程最新状态
   git fetch --all
   git reset --hard origin/hexo
   # 彻底清理并重装依赖
   hexo clean
   rm -rf node_modules
   npm install
   ```

   

4. **主题自定义修改未同步**

   - **原因**：主题文件夹包含内嵌 `.git` 子模块，文件未被跟踪。
   - **解决**：删除主题内的 `.git` 目录 (`rm -rf themes/主题名/.git`)，然后将整个主题重新提交。

------

## 六、高阶场景与故障处理

### 场景一：遇到合并冲突 (CONFLICT)

当 `git pull` 提示冲突时：

1. **不要慌**，Git已暂停等你解决。

2. 使用 `git status` 查看冲突文件。

3. 手动编辑冲突文件（包含 `<<<<<<<`， `=======`， `>>>>>>>` 标记），保留想要的内容并删除标记。

4. 解决后执行：

   bash

   ```
   git add .  # 标记冲突已解决
   git commit -m “解决合并冲突”
   ```

   

5. 继续正常推送流程。

### 场景二：推送失败，提示“非快进式推送”

**原因**：远程已有本地没有的新提交（可能来自另一台电脑）。
**解决**：

bash

```
# 先拉取合并
git pull origin hexo
# 解决可能出现的冲突
# 再次推送
git push origin hexo
```



------

## 七、最佳实践清单

1. **勤提交，勤推送**：完成一个逻辑改动（如一篇文章）就立即提交推送，避免本地积攒大量改动。
2. **写清晰的提交信息**：例如 `feat: 更新Next主题至v8.15.1，启用暗黑模式`。
3. **部署前先预览**：养成 `hexo g && hexo s` 预览的习惯，避免错误直接上线。
4. **保持环境一致**：尽量保持各电脑间 **Node.js** 和 **Hexo** 主版本号一致。
5. **善用 `.gitignore`**：确保仓库只跟踪真正的“源文件”。
6. **定期备份**：除了Git，可定期将整个博客目录压缩备份至网盘。

------

## 总结

通过上述基于Git双分支的流程，你可以在任何一台电脑上无缝接力管理Hexo博客。关键在于：

1. **源文件同步走 `hexo` 分支**。
2. **网站部署走 `main` 分支**。
3. 日常操作严格遵守 **“先拉后推”** 的协作习惯。

遵循本指南，即可像使用云文档一样，实现高效、安全的多设备博客管理。