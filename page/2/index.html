<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/006.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/6.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto Sans SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><script src="https://kit.fontawesome.com/b1f8a1a551.js" crossorigin="anonymous"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css"><script src="/lib/pace/pace.min.js"></script><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"www.mcorazon.top",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"default"},back2top:{enable:!0,sidebar:!0,scrollpercent:!0},bookmark:{enable:!1,color:"#00f",save:"manual"},fancybox:!0,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"buttons",active:"gitalk",storage:!0,lazyload:!1,nav:null,activeClass:"gitalk"},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><link rel="stylesheet" href="/css/head.css"><meta name="description" content="这世界总有黑夜可我们总发着光"><meta property="og:type" content="website"><meta property="og:title" content="MCorazon"><meta property="og:url" content="https://www.mcorazon.top/page/2/index.html"><meta property="og:site_name" content="MCorazon"><meta property="og:description" content="这世界总有黑夜可我们总发着光"><meta property="og:locale" content="zh_CN"><meta property="article:author" content="Corazon"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.mcorazon.top/page/2/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!0,isPost:!1,lang:"zh-CN"}</script><title>MCorazon</title><script type="text/javascript" src="/js/tag/bubble.js"></script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">MCorazon</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description"><font color="#ffffff" font-size="8em">强者,绝非偶然</font></p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-schedule"><a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a></li><li class="menu-item menu-item-commonweal"><a href="/commonweal/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="reading-progress-bar"></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content index posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.mcorazon.top/posts/2c8b313c/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/006.png"><meta itemprop="name" content="Corazon"><meta itemprop="description" content="<font color="#000000">这世界总有黑夜<br>可我们总发着光</font>"> </span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="MCorazon"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/posts/2c8b313c/" class="post-title-link" itemprop="url">【Linux】Linux总结（待完善）</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2025-07-11 11:53:32" itemprop="dateCreated datePublished" datetime="2025-07-11T11:53:32+08:00">2025-07-11</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-07-18 15:01:10" itemprop="dateModified" datetime="2025-07-18T15:01:10+08:00">2025-07-18</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>26k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>24 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="未总结">未总结</h2><p>alternatives</p><h2 id="文件系统介绍">文件系统介绍</h2><h3 id="文件及其功能">文件及其功能</h3><p>系统目录结构</p><table><thead><tr><th>目录</th><th>内容</th></tr></thead><tbody><tr><td><strong>bin</strong></td><td><strong>目录全称(binary) 存放二进制命令文件(普通用户可以使用)</strong></td></tr><tr><td>sbin</td><td>目录存放二进制命令文件(root用户可以使用)</td></tr><tr><td><strong>etc</strong></td><td><strong>目录存放软件程序或系统程序配置文件</strong></td></tr><tr><td>lib</td><td>目录会存放需要调取库文件信息 旧软件程序调取库文件</td></tr><tr><td>lib64</td><td>目录会存放需要调取库文件信息 新软件程序调取库文件</td></tr><tr><td>media</td><td>可以存放实例视频或图片 可以用于作为默认挂载点</td></tr><tr><td>mnt</td><td>可以用于作为默认挂载点</td></tr><tr><td>opt</td><td>目录存放第三方软件程序数据 等价于Windows program files</td></tr><tr><td>usr</td><td>目录存放第三方软件程序数据 等价于Windows program files</td></tr><tr><td><strong>root</strong></td><td><strong>用户信息存放家目录 root用户的家 ~</strong></td></tr><tr><td>home</td><td>用户信息存放家目录 普通用户的家~</td></tr><tr><td>boot</td><td>目录存放系统启动相关的数据</td></tr><tr><td><strong>dev</strong></td><td><strong>目录会存放一些设备文件信息</strong></td></tr><tr><td><strong>var</strong></td><td><strong>目录全称(variable),用于存放日志文件的</strong></td></tr><tr><td>tmp</td><td>目录用于临时存放文件信息 类似于Windows 回收站</td></tr><tr><td><strong>proc</strong></td><td><strong>目录中会存放系统内核配置信息或服务进程信息 不会占用磁盘空间 只会占用内存空间</strong></td></tr></tbody></table><h3 id="系统配置信息">系统配置信息</h3><table><thead><tr><th>文件</th><th>路径</th></tr></thead><tbody><tr><td>网卡配置</td><td>/etc/sysconfig/network-scripts/ifcfg-ens33<br>/etc/sysconfig/network-scripts/ifcfg-eth0</td></tr><tr><td>主机名</td><td>/etc/hostname</td></tr><tr><td>域名配置文件</td><td>/etc/resolv.conf</td></tr><tr><td>环境变量</td><td>/etc/profile<br>/etc/bashrc<br>~/.bash_profile<br>~/.bashrc</td></tr><tr><td>开机自动加载命令文件</td><td>/etc/rc.d/rc.local</td></tr><tr><td>用户登录信息提示文件</td><td>/etc/motd</td></tr><tr><td>系统版本信息</td><td>/etc/[redhat/centos/os(kali是os)]-release</td></tr><tr><td>系统存储硬件信息</td><td>/proc/cpuinfo</td></tr><tr><td>docker配置文件</td><td></td></tr><tr><td>nginx配置文件</td><td></td></tr><tr><td>nginx启动文件</td><td></td></tr><tr><td>配置函数信息的文件</td><td>/etc/init.d/functions</td></tr><tr><td></td><td>/etc/docker/daemon.json</td></tr><tr><td>docker代理配置文件</td><td>/etc/systemd/system/docker.service.d/http-proxy.conf</td></tr></tbody></table><table><thead><tr><th>目录</th><th>路径</th></tr></thead><tbody><tr><td>自动加载运行脚本目录</td><td>/etc/profile.d/</td></tr><tr><td>系统安装软件目录(rpm 手动方式 yum 自动方式)</td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr></tbody></table><h3 id="日志信息">日志信息</h3><h4 id="日志文件">日志文件</h4><p>Linux系统拥有非常灵活和强大的日志功能，可以保存几乎所有的操作记录，并可以从中检索出我们 需要的信息。</p><ol><li class="lvl-3"><p>内核及系统日志由系统服务rsyslog统一进行管理，日志格式基本相似</p></li><li class="lvl-3"><p>用户日志记录系统用户登录及退出系统的相关信息</p></li><li class="lvl-3"><p>程序日志由相应的应用程序进行独立管理。如：web服务，ftp服务 常见日志文件</p></li></ol><table><thead><tr><th><strong>日志文件</strong></th><th><strong>作用</strong></th></tr></thead><tbody><tr><td><strong>/var/log/secure</strong></td><td><strong>登录日志。记录验证和授权方面的信息，只要涉及账号和密码的程序都会记录， 比如 SSH登录， su登录，切换用户， sudo授权，甚至添加用户和修 改用户密码都会记录在这 个日志文件中。新版的ubuntu、debian、kali已经没有这个文件了 ， 换成了 /var/log/auth.log</strong></td></tr><tr><td>/var/log/message</td><td>通用的系统活动日志。记录内核消息、系统服务（邮件、cron等）的常规信息、非关键网络错误等。</td></tr><tr><td>/var/log/cron</td><td>每当cron进程开始一个工作时，就 会将相关信息记录在这个 文件中。</td></tr><tr><td>/var/log/syslog</td><td>所有系统活动信息（比 <code>messages</code> 更全面）。包含内核、服务、应用等除认证外的所有信息。</td></tr><tr><td><strong>/var/log/wtmp</strong></td><td><strong>永久记录所有用户的登录、注销信息，同时记录系统的启动、重启、 关机事件。同样这个文件也是一个二进制文件，不能直接编辑查看， 而需要使用 last命令来查看</strong></td></tr><tr><td><strong>/var/run/utmp</strong></td><td><strong>记录当前已经登录的用户信息，这个文件会随着用户的登录和注销不 断变化，只记录当前登录用户的信息。同样这个文件不能直接编辑查 看，而要使用 w,who,users等命令来查询</strong></td></tr><tr><td><strong>/var/log/btmp</strong></td><td><strong>记录所有失败登录日志信息。这个文件是二进制文件，不能直接编辑 查看，使用 lastb命令或 last -f /var/log/btmp 命令可以查看btmp文件。</strong></td></tr><tr><td>/var/log/cups</td><td>涉及所有打印信息的日志。</td></tr><tr><td>/var/log/faillog</td><td>包含用户登录失败信息。此外，错误登录命令也会记录在本文件中</td></tr><tr><td>/var/log/messages</td><td>记录系统重要信息的日志。这个日志文件中会记录Linux系统的绝大 多数重要信息，如果系统出现问题时，首先要检查的就应该是这个日 志文件。此外， mail，cron，daemon，kern和auth等内容也记录在var/log/messages</td></tr><tr><td>/var/log/dmesg</td><td>包含内核缓冲信息（ kernel ring buffer）。在系统启动时，会在屏幕上显示许多与硬件有关的信息。可以用 dmesg命令直接查看内核自检信息</td></tr><tr><td><strong>/var/log/auth.log</strong></td><td><strong>包含系统授权信息，包括用户登录和使用的权限机制等。</strong></td></tr><tr><td>/var/log/boot.log</td><td>包含系统启动时的日志。</td></tr><tr><td>/var/log/daemon.log</td><td>包含各种系统后台守护进程日志信息。</td></tr><tr><td>/var/log/dpkg.log</td><td>包括安装或 dpkg命令清除软件包的日志。</td></tr><tr><td>/var/log/kern.log</td><td>包含内核产生的日志，有助于在定制内核时解决问题。</td></tr><tr><td><strong>/var/log/lastlog</strong></td><td><strong>记录系统中所有用户最后一次登录时间的日志，这个文件是二进制文 件，不能直接编辑查看，而要使用 lastlog命令查看</strong></td></tr><tr><td>/var/log/user.log</td><td>记录所有等级用户信息的日志。</td></tr><tr><td>/var/log/alternatives.log</td><td>更新替代信息都记录在这个文件中。</td></tr><tr><td>/var/log/anaconda.log</td><td>在安装Linux时，所有安装信息都储存在这个文件中。</td></tr><tr><td>/var/log/yum.log</td><td>包含使用 yum安装的软件包信息。</td></tr><tr><td>/var/log/maillog<br>/var/log/mail.log</td><td>包含系统运行电子邮件服务器的日志信息。例如， sendmail日志信息就全部送到这个 文件中</td></tr></tbody></table><p>比较重要的几个日志：</p><blockquote><p>登录失败记录：/var/log/btmp #lastb<br>最后一次登录：/var/log/lastlog #lastlog<br>登录成功记录: /var/log/wtmp #last<br>登录日志记录：/var/log/secure<br>目前登录用户信息：/var/run/utmp #w、who、users<br>历史命令记录：history<br>仅清理当前用户：history -c</p></blockquote><h3 id="网卡配置">网卡配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">vim  /etc/sysconfig/network-scripts/ifcfg-ens33</span><br><span class="line"><span class="comment"># 网络接口类型（通常为 Ethernet 或 Bridge）</span></span><br><span class="line">TYPE=Ethernet</span><br><span class="line"><span class="comment"># 代理配置方式（none 表示不使用代理）</span></span><br><span class="line">PROXY_METHOD=none</span><br><span class="line"><span class="comment"># 是否仅用于浏览器代理（no 表示不限制）</span></span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line"><span class="comment"># 获取IP地址的方式（static 表示静态IP，dhcp 表示动态获取）</span></span><br><span class="line">BOOTPROTO=static</span><br><span class="line"><span class="comment"># 静态IP地址（需根据实际网络规划设置）</span></span><br><span class="line">IPADDR=10.0.0.5</span><br><span class="line"><span class="comment"># 子网掩码（定义IP地址的网络部分）</span></span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line"><span class="comment"># 默认网关（路由器的IP地址）</span></span><br><span class="line">GATEWAY=10.0.0.254</span><br><span class="line"><span class="comment"># 主DNS服务器地址（注意：此处错误添加了域名，应仅保留IP）</span></span><br><span class="line">DNS1=10.0.0.254</span><br><span class="line"><span class="comment"># 是否启用默认路由（yes 启用）</span></span><br><span class="line">DEFROUTE=<span class="built_in">yes</span></span><br><span class="line"><span class="comment"># IPv4配置失败时是否视为严重错误（no 表示不终止网络服务）</span></span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line"><span class="comment"># 是否初始化IPv6（yes 启用）</span></span><br><span class="line">IPV6INIT=<span class="built_in">yes</span></span><br><span class="line"><span class="comment"># 是否自动配置IPv6地址（yes 启用）</span></span><br><span class="line">IPV6_AUTOCONF=<span class="built_in">yes</span></span><br><span class="line"><span class="comment"># 是否启用IPv6默认路由（yes 启用）</span></span><br><span class="line">IPV6_DEFROUTE=<span class="built_in">yes</span></span><br><span class="line"><span class="comment"># IPv6配置失败时是否视为严重错误（no 表示不终止网络服务）</span></span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line"><span class="comment"># IPv6地址生成模式（增强隐私保护）</span></span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line"><span class="comment"># 网络连接名称（自定义标识）</span></span><br><span class="line">NAME=ens33</span><br><span class="line"><span class="comment"># 设备唯一标识符（系统自动生成，通常无需修改）</span></span><br><span class="line">UUID=27a73818-89f3-4991-9890-2da7924a73c4</span><br><span class="line"><span class="comment"># 物理设备名称（需与网卡实际名称一致）</span></span><br><span class="line">DEVICE=ens33</span><br><span class="line"><span class="comment"># 是否在系统启动时激活此连接（yes 启用）</span></span><br><span class="line">ONBOOT=<span class="built_in">yes</span></span><br></pre></td></tr></table></figure><p>更改配置需要重启网卡<code>systemctl restart network</code> 或 <code>service network restart</code></p><h3 id="域名解析配置">域名解析配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/resolv.conf    <span class="comment">#域名解析配置文件</span></span><br><span class="line">nameserver 10.0.0.254   <span class="comment">#DNS服务器，不能写错 写错就访问不了了</span></span><br><span class="line"><span class="built_in">cat</span> /cat /etc/hosts     <span class="comment">#访问内网的域名配置文件</span></span><br></pre></td></tr></table></figure><h2 id="系统管理">系统管理</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#关机命令 --关闭虚拟系统</span></span><br><span class="line">shutdown -h now <span class="comment">#立即关机</span></span><br><span class="line">shutdown -h 0 </span><br><span class="line">shutdown -h now</span><br><span class="line">shutdown -h 5   <span class="comment">#五分钟之后关机</span></span><br><span class="line">init 0</span><br><span class="line">half</span><br><span class="line"></span><br><span class="line"><span class="comment">#重启命令</span></span><br><span class="line">shutdown -r 0/now  <span class="comment">#立即重启</span></span><br><span class="line">init 6</span><br><span class="line">reboot             <span class="comment">#立即重启</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#修改主机名</span></span><br><span class="line"><span class="comment">#临时修改</span></span><br><span class="line">hostname name</span><br><span class="line"><span class="comment">#永久修改</span></span><br><span class="line">hostnamectl set-hostname name</span><br><span class="line"><span class="comment">#只是对系统环境变量作修改  修改之后要bash命令刷新</span></span><br></pre></td></tr></table></figure><h3 id="环境变量">环境变量</h3><p>和变量 环境变量 别名相关的配置文件信息：<code>/etc/profile</code>、<code>/etc/bashrc</code>、<code>~/.bash_profile</code> 、<code>~/.bashrc</code>、<code>/etc/profile.d/</code></p><p>网安关注应急效应，异常占用资源、进程关闭后再次运行，有可能是 profile 被植入脚本运行命令。<code>/etc/profile</code> 、<code>/etc/bashrc</code>、两个文件写到任意一个都会受到影响（把某个恶意跑进程的脚本放进去）。局部变量优于全局变量</p><h3 id="设置别名">设置别名</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#设置别名</span></span><br><span class="line"><span class="built_in">alias</span> eth0=<span class="string">&#x27;cat /etc/sysconfig/network-scripts/ifcfg-ens33&#x27;</span></span><br><span class="line"><span class="comment">#取消别名</span></span><br><span class="line"><span class="built_in">unalias</span> eth0</span><br><span class="line"><span class="comment">#永久设置</span></span><br><span class="line"><span class="built_in">alias</span> eth0=<span class="string">&#x27;cat /etc/sysconfig/network-scripts/ifcfg-eth0&#x27;</span> &gt;&gt; /etc/profile</span><br></pre></td></tr></table></figure><h3 id="其他命令">其他命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># history 查看历史命令</span></span><br><span class="line"><span class="built_in">history</span> -c   <span class="comment">#清除历史记录（慎用）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># free  查看空间使用情况</span></span><br><span class="line">free -h</span><br><span class="line"></span><br><span class="line"><span class="comment"># df 查看磁盘使用情况</span></span><br><span class="line"><span class="built_in">df</span> -h</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="文件管理">文件管理</h2><h3 id="文件类型">文件类型</h3><p><img src="/images/loading.jpeg" data-original="/posts/2c8b313c//image-20250714181833893.png" alt="image-20250714181833893"></p><p>①文件属性索引节点 --inode(唯一的)–身份证号<br>②文件属性信息和文件权限信息<br>③文件硬链接数:查看文件数据信息的多个门(类似于挂载)<br>④文件属主信息:文件管理者/文件创建者<br>⑤文件属组信息/所属用户组信息: 便于进行权限整体分配<br>⑥文件数据信息大小尺寸<br>⑦文件数据最后修改时间信息（Mtime）</p><p>文件类型:告诉系统管理者这个文件是什么类型 f(-) d c b s p l</p><table><thead><tr><th>文件类型</th><th style="text-align:center">字符</th><th>含义</th></tr></thead><tbody><tr><td>普通文件</td><td style="text-align:center">-</td><td>文本 图片等</td></tr><tr><td>目录文件</td><td style="text-align:center">d</td><td>目录</td></tr><tr><td>链接字文件</td><td style="text-align:center">|</td><td>==Windows 桌面快捷方式</td></tr><tr><td>块设备文件</td><td style="text-align:center">b</td><td>存储数据以供系统存取的接口设备，简单而言就是硬盘。</td></tr><tr><td>字符设备文件</td><td style="text-align:center">c</td><td>即串行端口的接口设备，例如键盘、鼠标等等。</td></tr><tr><td>套接字文件</td><td style="text-align:center">s</td><td>这类文件通常用在网络数据连接。可以启动一个程序来监听客户端的要求，客户端就可以通过套接字来进行数据通信。第一个属性为 [s]，最常在 /var/run目录中看到这种文件类型</td></tr><tr><td>管道文件</td><td style="text-align:center">p</td><td>FIFO也是一种特殊的文件类型，它主要的目的是，解决多个程序同时存取一个文件所造成的错误。FIFO是first-in-first-out(先进先出)的缩写。</td></tr></tbody></table><h3 id="常用命令">常用命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1 mkdir</span></span><br><span class="line"><span class="built_in">mkdir</span> directionName  <span class="comment">#创建目录</span></span><br><span class="line"><span class="built_in">mkdir</span> -p a/b/c/      <span class="comment">#创建多级目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2 ls ll</span></span><br><span class="line"><span class="built_in">ls</span> -l    <span class="comment">#查看目录下的文件属性信息  等于ll</span></span><br><span class="line"><span class="built_in">ls</span> -lh   <span class="comment">#以人类可读方式显示文件大小信息  等于ll -h</span></span><br><span class="line"><span class="built_in">ls</span> -a    <span class="comment">#查看目录下所有的数据信息 包含隐藏文件</span></span><br><span class="line"><span class="built_in">ls</span> -li   <span class="comment">#查看文件属性索引节点indode</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3 cd</span></span><br><span class="line"><span class="built_in">cd</span>       <span class="comment">#返回家目录</span></span><br><span class="line"><span class="built_in">cd</span> /     <span class="comment">#返回根目录</span></span><br><span class="line"><span class="built_in">cd</span> ..    <span class="comment">#切换至上级目录</span></span><br><span class="line"><span class="built_in">cd</span> -     <span class="comment">#切换至上次所在目录</span></span><br><span class="line">带<span class="string">&#x27;/&#x27;</span>绝对路径，不带<span class="string">&#x27;/&#x27;</span>相对路径</span><br><span class="line"></span><br><span class="line"><span class="comment">#4 rm</span></span><br><span class="line"><span class="built_in">rm</span> -r filename filename   <span class="comment">#递归删除</span></span><br><span class="line"><span class="built_in">rm</span> -f     <span class="comment">#强制删除（无需确认）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#5 cp</span></span><br><span class="line"><span class="built_in">cp</span>  /路径/旧文件  /路径/新文件</span><br><span class="line"><span class="built_in">cp</span>  -r  /路径/目录   /路径/目录</span><br><span class="line"></span><br><span class="line"><span class="comment">#6 mv</span></span><br><span class="line"><span class="built_in">mv</span>  文件/目录  新目录/</span><br><span class="line"><span class="built_in">mv</span> a b   <span class="comment">#修改文件名</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#7 touch</span></span><br><span class="line"><span class="built_in">touch</span> filename   <span class="comment">#创建新文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#8 cat/tacless/more/heatail</span></span><br><span class="line"><span class="built_in">cat</span> -n filename  <span class="comment">#[带行号]查看文件内容</span></span><br><span class="line"><span class="built_in">cat</span>&gt;&gt;a&lt;&lt;<span class="string">EOF      #追加新内容</span></span><br><span class="line"><span class="string">&gt; hello</span></span><br><span class="line"><span class="string">&gt; EOF</span></span><br><span class="line"><span class="built_in">cat</span>&gt;a&lt;&lt;<span class="string">EOF     #覆盖原始内容</span></span><br><span class="line"><span class="string">&gt; world</span></span><br><span class="line"><span class="string">&gt; EOF</span></span><br><span class="line"><span class="built_in">head</span> [-n]      <span class="comment">#查看n行（默认10行）</span></span><br><span class="line"><span class="built_in">tail</span> [-n]      <span class="comment">#查看末尾n行（默认10行）</span></span><br><span class="line"><span class="built_in">tail</span> -f        <span class="comment">#动态查看文件 适用于追踪日志文件信息变化</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#9 重定向</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;123456&quot;</span>&gt;hxjl.txt   <span class="comment">#覆盖重定向</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;123456&quot;</span>&gt;&gt;hxjl.txt  <span class="comment">#追加重定向</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#10 echo</span></span><br><span class="line"><span class="built_in">echo</span> -e  可以实现空格的不同使用  </span><br><span class="line">-e \n           <span class="comment">#换行</span></span><br><span class="line">-e \t           <span class="comment">#tab空格</span></span><br><span class="line">-e \c           <span class="comment">#不换行</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$envname</span>   <span class="comment">#打印环境变量</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#11 grep</span></span><br><span class="line">grep [-参数] string filename   <span class="comment">#文件中筛选字符串；</span></span><br><span class="line">-i             <span class="comment">#不区分大小写</span></span><br><span class="line">-n             <span class="comment">#显示行号</span></span><br><span class="line">-c             <span class="comment">#统计匹配的行数</span></span><br><span class="line">-v             <span class="comment">#排除指定信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#12 tree 展示目录下的结构</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#13 lrzsz</span></span><br><span class="line">rz -y           <span class="comment">#从Windows上传文件到Linux</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#14 wget</span></span><br><span class="line">wget url        <span class="comment">#下载Web内容到本机</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#15 file </span></span><br><span class="line">file fileName   <span class="comment">#查看文件类型/属性</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#16 rpm RPM是Red Hat公司随Redhat Linux推出了一个软件包管理器，通过它能够更加轻松容易地实现软件的安装。</span></span><br><span class="line"><span class="comment">#常见用法：</span></span><br><span class="line">rpm -ivh &lt;rpm包名&gt;        <span class="comment">#安装软件</span></span><br><span class="line">rpm -e &lt;rpm包名&gt;          <span class="comment">#卸载安装</span></span><br><span class="line">rpm -Uvh &lt;rpm包名&gt;        <span class="comment">#升级一个rpm</span></span><br><span class="line">rpm -qi &lt;rpm包名&gt;         <span class="comment">#显示软件安装信息</span></span><br><span class="line">rpm -qa | grep xxx       <span class="comment">#查询软件是否安装（包括相关依赖）</span></span><br><span class="line">rpm -qc &lt;包名&gt;	        <span class="comment">#仅列出包的配置文件</span></span><br><span class="line">rpm -qd &lt;包名&gt;	        <span class="comment">#仅列出包的文档文件（手册、README等）</span></span><br><span class="line">rpm -qlp &lt;RPM文件路径&gt;	   <span class="comment">#查询未安装的RPM包内包含哪些文件</span></span><br><span class="line">rpm -q --scripts &lt;包名&gt;	<span class="comment">#查看包的安装/卸载脚本</span></span><br><span class="line">-i, --install	     <span class="comment">#安装软件包	rpm -ivh package.rpm</span></span><br><span class="line">-v	--verbose        <span class="comment">#列出更多详细信息，安装进度	rpm -v install package.rpm</span></span><br><span class="line">-h, --<span class="built_in">hash</span>           <span class="comment">#安装时列出hash标记 (与 -v连用)  rpm -ihv package.rpm</span></span><br><span class="line">-U, --update	     <span class="comment">#升级软件包	rpm -Uvh new-package.rpm</span></span><br><span class="line">-e, --erase	         <span class="comment">#卸载软件包	rpm -e package-name</span></span><br><span class="line">-V, --verify         <span class="comment">#校验软件包文件完整性	rpm -V httpd</span></span><br><span class="line">-l	                 <span class="comment">#列出文件 (list files)</span></span><br><span class="line">–<span class="built_in">test</span>                <span class="comment">#安装测试，并不实际安装</span></span><br><span class="line">-q, --query 	     <span class="comment">#查询软件包信息	rpm -q httpd</span></span><br><span class="line"> -a, --all           <span class="comment">#查询/校验所有的安装包</span></span><br><span class="line"> -p, --package       <span class="comment">#查询/校验一个安装文件</span></span><br><span class="line"> -l, --list          <span class="comment">#列出安装文件</span></span><br><span class="line"> -d, --docfiles      <span class="comment">#列出所有文档文件</span></span><br><span class="line"> -f, --file          <span class="comment"># 查询/校验安装包中所包含的文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#17 stat</span></span><br><span class="line"><span class="built_in">stat</span> filename    <span class="comment">#查看文件属性（Size、Blocks、Inode、Atime、Mtime、Ctime等）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#18 cut</span></span><br><span class="line">-c n1-n2         <span class="comment">#截取n1到n2的字符</span></span><br></pre></td></tr></table></figure><h2 id="用户及权限管理">用户及权限管理</h2><h3 id="权限">权限</h3><table><thead><tr><th style="text-align:center">字符</th><th>权限</th></tr></thead><tbody><tr><td style="text-align:center">w—4</td><td>写权限</td></tr><tr><td style="text-align:center">r----2</td><td>读权限</td></tr><tr><td style="text-align:center">x----1</td><td>执行权限（脚本文件先赋权才能再执行）</td></tr></tbody></table><h3 id="用户">用户</h3><table><thead><tr><th>字符</th><th>含义</th></tr></thead><tbody><tr><td>u</td><td>所属主 uid</td></tr><tr><td>g</td><td>所属组 gid</td></tr><tr><td>o</td><td>其他人 others</td></tr><tr><td>a</td><td>所有人 all</td></tr></tbody></table><h3 id="权限命令">权限命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1 chmod</span></span><br><span class="line"><span class="built_in">chmod</span> XXX filename   <span class="comment">#数字赋权</span></span><br><span class="line"><span class="built_in">chmod</span> +x filename    <span class="comment">#添加执行权</span></span><br><span class="line"><span class="built_in">chmod</span> u+x,g+x,o+x  filename   <span class="comment">#所有用户添加执行权==chmod +x filename==chmod a+x filename</span></span><br></pre></td></tr></table></figure><h2 id="磁盘管理">磁盘管理</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1 du</span></span><br><span class="line"><span class="built_in">du</span> -sh filePath   <span class="comment">#文件存储到磁盘所占的空间（block）</span></span><br></pre></td></tr></table></figure><h2 id="vim使用">vim使用</h2><p>普通模式的一些快捷命令：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">yy    复制光标所在行</span><br><span class="line">nyy   数字yy 复制连续多行内容</span><br><span class="line"><span class="selector-tag">p</span>     粘贴复制/剪切的内容</span><br><span class="line">np    粘贴n次复制/剪切的内容 </span><br><span class="line"><span class="selector-tag">dd</span>    删除光标所在行</span><br><span class="line">ndd   删除n行</span><br><span class="line">D	  删除本行内容，但是保留空行</span><br><span class="line">dG    删除光标所在位置后的所有行内容</span><br><span class="line"><span class="selector-tag">G</span>     快速移动到最后一行</span><br><span class="line">gg	  快速移动到第一行</span><br><span class="line">nG    快速移动到第n行</span><br></pre></td></tr></table></figure><p>末行模式(命令模式)：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">实现 文件的内容保存 检索 替换 显示行号</span><br><span class="line">检索   :/要检索的内容</span><br><span class="line">替换   : %s/root/ROOT/g  </span><br><span class="line">--显示行号  :<span class="keyword">set</span> <span class="keyword">nu</span>   <span class="keyword">number</span> </span><br><span class="line">ESC→ : </span><br><span class="line">q不保存退出</span><br><span class="line">q! 强制不保存退出</span><br><span class="line"><span class="keyword">wq</span> 保存退出</span><br><span class="line">wq! 强制保存退出</span><br></pre></td></tr></table></figure><h2 id="linux常用命令">linux常用命令</h2><h3 id="常用命令-2">常用命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">1.进入到用户根目录</span><br><span class="line"><span class="built_in">cd</span> ~ 或 <span class="built_in">cd</span></span><br><span class="line"></span><br><span class="line">2.查看当前所在目录</span><br><span class="line"><span class="built_in">pwd</span></span><br><span class="line"></span><br><span class="line">3.进入到hadoop用户根目录</span><br><span class="line"><span class="built_in">cd</span> ~hadoop</span><br><span class="line"></span><br><span class="line">4.返回到原来目录</span><br><span class="line"><span class="built_in">cd</span> -</span><br><span class="line"></span><br><span class="line">5.返回到上一级目录</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line">6.查看hadoop用户根目录下的所有文件</span><br><span class="line"><span class="built_in">ls</span> -la</span><br><span class="line"></span><br><span class="line">7.在根目录下创建一个hadoop的文件夹</span><br><span class="line"><span class="built_in">mkdir</span> /hadoop</span><br><span class="line"></span><br><span class="line">8.在/hadoop目录下创建src和WebRoot两个文件夹</span><br><span class="line">分别创建：<span class="built_in">mkdir</span> /hadoop/src</span><br><span class="line">		  <span class="built_in">mkdir</span> /hadoop/WebRoot</span><br><span class="line">同时创建：<span class="built_in">mkdir</span> /hadoop/&#123;src,WebRoot&#125;</span><br><span class="line"></span><br><span class="line">进入到/hadoop目录，在该目录下创建.classpath和README文件</span><br><span class="line">分别创建：<span class="built_in">touch</span> .classpath</span><br><span class="line">		  <span class="built_in">touch</span> README</span><br><span class="line">同时创建：<span class="built_in">touch</span> &#123;.classpath,README&#125;</span><br><span class="line"></span><br><span class="line">查看/hadoop目录下面的所有文件</span><br><span class="line"><span class="built_in">ls</span> -la</span><br><span class="line"></span><br><span class="line">在/hadoop目录下面创建一个test.txt文件,同时写入内容<span class="string">&quot;this is test&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;this is test&quot;</span> &gt; test.txt</span><br><span class="line"></span><br><span class="line">查看一下test.txt的内容</span><br><span class="line"><span class="built_in">cat</span> test.txt</span><br><span class="line">more test.txt</span><br><span class="line">less test.txt</span><br><span class="line"></span><br><span class="line">向README文件追加写入<span class="string">&quot;please read me first&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;please read me first&quot;</span> &gt;&gt; README</span><br><span class="line"></span><br><span class="line">将test.txt的内容追加到README文件中</span><br><span class="line"><span class="built_in">cat</span> test.txt &gt;&gt; README</span><br><span class="line"></span><br><span class="line">拷贝/hadoop目录下的所有文件到/hadoop-bak</span><br><span class="line"><span class="built_in">cp</span> -r /hadoop /hadoop-bak</span><br><span class="line"></span><br><span class="line">进入到/hadoop-bak目录，将test.txt移动到src目录下，并修改文件名为Student.java</span><br><span class="line"><span class="built_in">mv</span> test.txt src/Student.java</span><br><span class="line"></span><br><span class="line">在src目录下创建一个struts.xml</span><br><span class="line">&gt; struts.xml</span><br><span class="line"></span><br><span class="line">删除所有的xml类型的文件</span><br><span class="line"><span class="built_in">rm</span> -rf *.xml</span><br><span class="line"></span><br><span class="line">删除/hadoop-bak目录和下面的所有文件</span><br><span class="line"><span class="built_in">rm</span> -rf /hadoop-bak</span><br><span class="line"></span><br><span class="line">返回到/hadoop目录，查看一下README文件有多单词，多少个少行</span><br><span class="line"><span class="built_in">wc</span> -w README</span><br><span class="line"><span class="built_in">wc</span> -l README</span><br><span class="line"></span><br><span class="line">返回到根目录，将/hadoop目录先打包，再用gzip压缩</span><br><span class="line">分步完成：tar -cvf hadoop.tar hadoop</span><br><span class="line">		  gzip hadoop.tar</span><br><span class="line">一步完成：tar -zcvf hadoop.tar.gz hadoop</span><br><span class="line">		  </span><br><span class="line">将其解压缩，再取消打包</span><br><span class="line">分步完成：gzip -d hadoop.tar.gz 或 gunzip hadoop.tar.gz</span><br><span class="line">一步完成：tar -zxvf hadoop.tar.gz</span><br><span class="line"></span><br><span class="line">将/hadoop目录先打包，同时用bzip2压缩，并保存到/tmp目录下</span><br><span class="line">tar -jcvf /tmp/hadoop.tar.bz2 hadoop</span><br><span class="line"></span><br><span class="line">将/tmp/hadoop.tar.bz2解压到/usr目录下面</span><br><span class="line">tar -jxvf hadoop.tar.bz2 -C /usr/</span><br><span class="line">123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081</span><br></pre></td></tr></table></figure><h3 id="系统命令">系统命令</h3><div class="post-button"><a class="btn" href="/posts/2c8b313c/" rel="contents">阅读全文 &raquo;</a></div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.mcorazon.top/posts/b1246162/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/006.png"><meta itemprop="name" content="Corazon"><meta itemprop="description" content="<font color="#000000">这世界总有黑夜<br>可我们总发着光</font>"> </span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="MCorazon"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/posts/b1246162/" class="post-title-link" itemprop="url">【Linux】docker安装</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2025-07-10 22:10:54" itemprop="dateCreated datePublished" datetime="2025-07-10T22:10:54+08:00">2025-07-10</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-07-11 11:23:02" itemprop="dateModified" datetime="2025-07-11T11:23:02+08:00">2025-07-11</time></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>1.7k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>2 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="docker安装">docker安装</h2><ol><li class="lvl-3"><strong>关闭安全程序</strong></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl stop iptables</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br><span class="line">systemctl <span class="built_in">disable</span> iptable</span><br><span class="line">iptables -F</span><br><span class="line"></span><br><span class="line">查看selinux是否关闭</span><br><span class="line">getenforce </span><br><span class="line">如果看到是disabled就说明关闭了</span><br><span class="line">如果看到enforcing就证明开着</span><br><span class="line"></span><br><span class="line">修改</span><br><span class="line">sed -i <span class="string">&#x27;7s#enforcing#disabled#g&#x27;</span> /etc/selinux/config</span><br><span class="line">生效</span><br><span class="line">setenforce 0</span><br></pre></td></tr></table></figure><ol start="2"><li class="lvl-3"><p><strong>让时间同步</strong></p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">yum install -y ntp ntpdate</span><br><span class="line">ntpdate cn.pool.ntp.org</span><br><span class="line"></span><br><span class="line">执行计划任务</span><br><span class="line">crontab -e</span><br><span class="line">* * * * * /usr/sbin/ntpdate  cn.pool.ntp.org &amp;&gt;/dev/null</span><br><span class="line"></span><br><span class="line">重启计划任务</span><br><span class="line">systemctl restart crond</span><br></pre></td></tr></table></figure><ol start="3"><li class="lvl-3"><p><strong>安装基础依赖程序</strong></p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum clean all &amp;&amp; yum makecache</span><br><span class="line">yum install -y device-mapper-persistent-data lvm2 wget net-tools nfs-utils lrzsz gcc gcc-c++ make cmake libxml2-devel openssl-devel curl curl-devel unzip <span class="built_in">sudo</span> ntp libaio-devel wget vim ncurses-devel autoconf automake zlib-devel  python-devel epel-release openssh-server socat  ipvsadm conntrack telnet ipvsadm  yum-utils</span><br></pre></td></tr></table></figure><ol start="4"><li class="lvl-3"><p><strong>安装阿里云docker源</strong></p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line">安装docker：</span><br><span class="line">yum install docker-ce -y</span><br><span class="line"></span><br><span class="line">安装完毕后可以执行</span><br><span class="line">docker version</span><br><span class="line">查看docker版本</span><br><span class="line"></span><br><span class="line">启动并开机运行docker</span><br><span class="line">systemctl start docker &amp;&amp; systemctl <span class="built_in">enable</span> docker</span><br><span class="line"></span><br><span class="line">检查docker是否启动成功</span><br><span class="line">systemctl status docker</span><br><span class="line">看到running就是成功了</span><br></pre></td></tr></table></figure><ol start="5"><li class="lvl-3"><p><strong>修改内核参数</strong></p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">modprobe br_netfilter</span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/sysctl.d/docker.conf &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables = 1</span></span><br><span class="line"><span class="string">net.ipv4.ip_forward = 1</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">修改完查看确认无误</span><br><span class="line"><span class="built_in">cat</span> /etc/sysctl.d/docker.conf</span><br><span class="line"></span><br><span class="line">生效：</span><br><span class="line">sysctl -p /etc/sysctl.d/docker.conf</span><br><span class="line"></span><br><span class="line">确认内核状态</span><br><span class="line">lsmod | grep br_netfilter</span><br><span class="line"></span><br><span class="line">重启后会失效，为了防止此情况</span><br><span class="line">vim /etc/sysconfig/modules/br_netfilter.modules</span><br><span class="line">编写内容：</span><br><span class="line">modprobe br_netfilter</span><br><span class="line">保存退出</span><br><span class="line"></span><br><span class="line">给他执行权限</span><br><span class="line"><span class="built_in">chmod</span> +x /etc/sysconfig/modules/br_netfilter.modules</span><br><span class="line"></span><br><span class="line">创建一个脚本文件：</span><br><span class="line">vim /etc/rc.sysinit</span><br><span class="line">内容：</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> /etc/sysconfig/modules/*.modules</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  [ -x <span class="variable">$file</span> ] &amp;&amp; <span class="variable">$file</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">保存退出</span><br><span class="line">可以通过reboot命令重启服务器查看是否生效</span><br></pre></td></tr></table></figure><p>本文参考：</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.mcorazon.top/posts/4c00139f/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/006.png"><meta itemprop="name" content="Corazon"><meta itemprop="description" content="<font color="#000000">这世界总有黑夜<br>可我们总发着光</font>"> </span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="MCorazon"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/posts/4c00139f/" class="post-title-link" itemprop="url">【Linux】docker使用</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2025-07-10 15:43:09" itemprop="dateCreated datePublished" datetime="2025-07-10T15:43:09+08:00">2025-07-10</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-07-17 22:00:34" itemprop="dateModified" datetime="2025-07-17T22:00:34+08:00">2025-07-17</time></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>4.4k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>4 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="镜像操作">镜像操作</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#能够连接镜像仓库情况下：</span></span><br><span class="line">docker search centos  <span class="comment">#找到相关镜像</span></span><br><span class="line"><span class="comment">#然后：</span></span><br><span class="line">docker pull centos  <span class="comment">#将镜像直接下载到docker里面</span></span><br><span class="line">docker images  <span class="comment">#查看镜像</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#现在docker官方镜像仓库不可用，只能使用离线镜像：</span></span><br><span class="line"><span class="comment">#如何使用离线镜像：</span></span><br><span class="line"><span class="comment">#首先将镜像上传到服务器</span></span><br><span class="line">rz -be上传镜像文件</span><br><span class="line"><span class="comment">#上传完毕后，上载到docker里</span></span><br><span class="line"><span class="comment">#容器镜像压缩包不要用tar命令进行解压，要用docker load加载及解压镜像压缩包</span></span><br><span class="line">docker load -i centos.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看镜像：</span></span><br><span class="line">docker images</span><br><span class="line"><span class="comment">#删除镜像：</span></span><br><span class="line">docker rmi [镜像名字]或[镜像ID] [镜像名字]或[镜像ID] ......</span><br></pre></td></tr></table></figure><h2 id="镜像加速">镜像加速</h2><p>我用了国内镜像源也没用，最后用的本机代理。如果有代理的话直接用代理吧。</p><p><strong>更改国内源：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /etc/docker</span><br><span class="line">vim /etc/docker/daemon.json</span><br><span class="line">添加如下内容：</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;registry-mirrors&quot;</span>:[<span class="string">&quot;https://a88u1jg4.mirror.aliyuncs.com&quot;</span>,<span class="string">&quot;https://docker.lmirror.top&quot;</span>,<span class="string">&quot;https://docker.m.daocloud.io&quot;</span>,<span class="string">&quot;https://hub.uuuabc.top&quot;</span>,<span class="string">&quot;https://docker.anyhub.us.kg&quot;</span>,<span class="string">&quot;https://dockerhub.jobcher.com&quot;</span>,<span class="string">&quot;https://dockerhub.icu&quot;</span>,<span class="string">&quot;https://docker.ckyl.me&quot;</span>,<span class="string">&quot;https://docker.awsl9527.cn&quot;</span>,<span class="string">&quot;https://docker.laoex.link&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">保存退出</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure><p><strong>使用代理：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /etc/systemd/system/docker.service.d</span><br><span class="line">vim /etc/systemd/system/docker.service.d/http-proxy.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#添加内容：</span></span><br><span class="line">[Service]</span><br><span class="line">Environment=<span class="string">&quot;HTTP_PROXY=http://user:password@ip:port/&quot;</span></span><br><span class="line">Environment=<span class="string">&quot;HTTPS_PROXY=http://user:password@ip:port/&quot;</span></span><br><span class="line">Environment=<span class="string">&quot;NO_PROXY=localhost,127.0.0.1,.example.com&quot;</span></span><br><span class="line"><span class="comment">#注意改成自己的代理ip和端口，如果没有密码去掉“user:password@”</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#刷新配置并重启 docker 服务</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl daemon-reload</span><br><span class="line"><span class="built_in">sudo</span> systemctl restart docker</span><br></pre></td></tr></table></figure><h2 id="容器操作：">容器操作：</h2><p>基础操作：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#进入一个镜像容器</span></span><br><span class="line">docker run --name 容器名称（自己取） -it centos(镜像的名称) /bin/bash(调用环境)</span><br><span class="line"><span class="comment">#退出容器</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">此时退出后，容器就会停止运行</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看所有的容器，包括停止的</span></span><br><span class="line">docker ps -a </span><br><span class="line"></span><br><span class="line"><span class="comment">#删除容器</span></span><br><span class="line">docker <span class="built_in">rm</span> [镜像名字]或[镜像ID]  <span class="comment">#（名称不能重复）</span></span><br><span class="line"><span class="comment">#守护形式容器（-d 不会退出就关闭）</span></span><br><span class="line">docker run --name=xiaoA -td centos /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看正在运行的容器</span></span><br><span class="line">docker ps</span><br><span class="line"></span><br><span class="line"><span class="comment">#进入正在运行的容器</span></span><br><span class="line">docker <span class="built_in">exec</span> -it xiaoA /bin/bash</span><br><span class="line"><span class="comment">#开启</span></span><br><span class="line">docker start 容器名（容器ID） 容器名（容器ID） ......</span><br><span class="line"><span class="comment">#重启</span></span><br><span class="line">docker restart 容器名（容器ID） 容器名（容器ID） ......</span><br><span class="line"><span class="comment">#停止容器</span></span><br><span class="line">docker stop 容器名（容器ID） 容器名（容器ID） ......</span><br><span class="line"><span class="comment">#强制停止正在运行的容器：</span></span><br><span class="line">docker <span class="built_in">kill</span> 容器名（容器ID） 容器名（容器ID） ......</span><br><span class="line"><span class="comment">#关闭所有容器：</span></span><br><span class="line">docker stop $(docker ps -a -q)</span><br><span class="line"><span class="comment">#删除所有容器：</span></span><br><span class="line">docker <span class="built_in">rm</span> $(docker ps -a -q)</span><br><span class="line"><span class="comment">#删除所有镜像</span></span><br><span class="line">docker rmi $(docker images -q)</span><br><span class="line"><span class="comment">#查看容器日志</span></span><br><span class="line">docker logs 容器名（容器ID）</span><br></pre></td></tr></table></figure><p>拓展：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">cp</span> sourcePath <span class="variable">$&#123;containerId&#125;</span>:destinationPath <span class="comment">#宿主机拷贝到容器</span></span><br><span class="line">docker <span class="built_in">cp</span> <span class="variable">$&#123;containerId&#125;</span>:sourcePath destinationPath <span class="comment">#容器拷贝到宿主机</span></span><br><span class="line">docker commit <span class="variable">$&#123;containerId&#125;</span> imageName:version      <span class="comment">#保存一个容器为镜像</span></span><br><span class="line">docker save -o destinationPath imageName            <span class="comment">#保存image方便传输</span></span><br><span class="line">docker load -i sourcePath                           <span class="comment">#加载一个文件到image</span></span><br></pre></td></tr></table></figure><h2 id="文件持久化存储">文件持久化存储</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建一个目录</span></span><br><span class="line"><span class="built_in">mkdir</span> ~/xiaoX_data</span><br><span class="line"><span class="comment">#新建一个容器</span></span><br><span class="line">docker run --name xiaoC -v ~/xiaoX_data:/data -itd centos /bin/bash</span><br><span class="line"><span class="comment">#进入容器</span></span><br><span class="line">docker <span class="built_in">exec</span> -it xiaoC /bin/bash</span><br><span class="line"><span class="built_in">cd</span> /data</span><br><span class="line"><span class="comment">#创建一些文件</span></span><br><span class="line"><span class="built_in">echo</span> abc &gt;&gt; 1.txt</span><br><span class="line"><span class="comment">#通过另一个终端，可以看到文件会出现在/root/xiaoX_data/下面</span></span><br><span class="line"><span class="comment">#所以该文件不会丢失</span></span><br></pre></td></tr></table></figure><h2 id="如何创建自定义容器">如何创建自定义容器</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#先创建一个放dockerfile的文件夹</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /root/dockerfile/inter-image</span><br><span class="line"><span class="comment">#进入创建的文件夹</span></span><br><span class="line"><span class="built_in">cd</span> /root/dockerfile/inter-image </span><br><span class="line"><span class="comment">#创建dockerfile（必须叫这个名字）</span></span><br><span class="line"><span class="built_in">touch</span> dockerfile</span><br></pre></td></tr></table></figure><p>老师给的<code>dockerfile</code>内容如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">FROM centos</span><br><span class="line">RUN sed -i <span class="string">&quot;s|mirrorlist=|#mirrorlist=|g&quot;</span> /etc/yum.repos.d/CentOS-*</span><br><span class="line">RUN sed -i <span class="string">&quot;s|#baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g&quot;</span> /etc/yum.repos.d/CentOS-*</span><br><span class="line">RUN yum install wget -y</span><br><span class="line">RUN yum install nginx -y</span><br><span class="line">EXPOSE 80</span><br><span class="line">CMD /bin/bash</span><br></pre></td></tr></table></figure><p>但是我一直下载不了<code>centos:latest</code>，所以做了改动：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">FROM centos:7</span><br><span class="line"><span class="comment"># 修复基础仓库地址</span></span><br><span class="line">RUN sed -i \</span><br><span class="line">    -e <span class="string">&quot;s|mirrorlist=|#mirrorlist=|g&quot;</span> \</span><br><span class="line">    -e <span class="string">&quot;s|#baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g&quot;</span> \</span><br><span class="line">    /etc/yum.repos.d/CentOS-*</span><br><span class="line"><span class="comment"># 安装 EPEL 仓库（nginx所在仓库）</span></span><br><span class="line">RUN yum install -y epel-release</span><br><span class="line"><span class="comment"># 安装所需软件（合并命令减少层数）</span></span><br><span class="line">RUN yum install -y wget nginx</span><br><span class="line">EXPOSE 80</span><br><span class="line">CMD /bin/bash  <span class="comment"># 保持前台运行</span></span><br></pre></td></tr></table></figure><p>保存上面内容后退出</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t <span class="string">&quot;inter-image&quot;</span> .  <span class="comment">#构建镜像</span></span><br></pre></td></tr></table></figure><p>构建完毕以后该镜像就会生成到docker里</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker images  <span class="comment">#查看镜像</span></span><br><span class="line">docker save -o 名字.tar.gz 镜像名字 </span><br><span class="line">docker save -o inter-image.tar.gz inter-image </span><br><span class="line">docker run --name inter-image -v ~/dataxiaoE:/data -itd inter-image  /bin/bash <span class="comment">#构建一个容器</span></span><br><span class="line">docker <span class="built_in">exec</span> -it inter-image /bin/bash <span class="comment">#进入容器</span></span><br><span class="line">/usr/sbin/nginx -t  <span class="comment">#开启nginx服务</span></span><br><span class="line">ip a</span><br><span class="line">curl ip:80  <span class="comment">#访问到nginx欢迎页面</span></span><br><span class="line"><span class="built_in">exit</span>  <span class="comment">#退出</span></span><br></pre></td></tr></table></figure><h2 id="容器之间互联">容器之间互联</h2><h3 id="ip互联">ip互联</h3><p>基于上面创建的inter-image镜像分别启动容器test1和test2，并进入到容器中。</p><p>查询ip地址即可互联</p><p><img src="/images/loading.jpeg" data-original="/posts/4c00139f//image-20250710214550350-17521567889481.png" alt="image-20250710214550350"></p><p>开启nginx服务后也可以通过 <code>curl</code> 命令连</p><p><img src="/images/loading.jpeg" data-original="/posts/4c00139f//image-20250710220009917-17521567983984.png" alt="image-20250710220009917"></p><h3 id="网络别名互联">网络别名互联</h3><p>定义网络别名（防止容器ip变化了，导致我们访问不到）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run --name test3 -td inter-image  <span class="comment">#创建一个测试容器</span></span><br><span class="line">docker run --name test4 -td --<span class="built_in">link</span>=test3:webtest inter-image  <span class="comment">#创建别名容器</span></span><br><span class="line">docker <span class="built_in">exec</span> -it test4 /bin/bash  <span class="comment">#进入别名容器</span></span><br><span class="line">ping webtest <span class="comment">#就可以无视test3容器IP变化</span></span><br></pre></td></tr></table></figure><p><img src="/images/loading.jpeg" data-original="/posts/4c00139f//image-20250710205010145-175215682419010.png" alt="image-20250710205010145"></p><h2 id="docker的网络权限">docker的网络权限</h2><p>host模式：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run --name host -it --net=host --privileged=true centos:<span class="number">7</span></span><br><span class="line">ip a  <span class="comment">#发现和本机的IP一样</span></span><br><span class="line"><span class="keyword">exit</span>  <span class="comment">#退出</span></span><br><span class="line">docker rm host  <span class="comment">#删除容器</span></span><br></pre></td></tr></table></figure><p>none模式：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -td --name none --net=none --privileged=true centos:<span class="number">7</span></span><br><span class="line">docker exec -it none <span class="regexp">/bin/</span>bash</span><br><span class="line">ip a  <span class="comment">#发现只有lo网卡</span></span><br><span class="line"><span class="keyword">exit</span>  <span class="comment">#退出</span></span><br></pre></td></tr></table></figure><h2 id="如何判断是否为docker环境">如何判断是否为docker环境</h2><p>可以通过：<code>cat /proc/1/cgroup</code>命令查看内容</p><p><img src="/images/loading.jpeg" data-original="/posts/4c00139f//image-20250710223300288.png" alt="image-20250710223300288"></p><p>也可以通过<code>ls -alh /.dockerenv</code>查看是否有容器环境文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@92a79e791862 /]# <span class="built_in">ls</span> -a /</span><br><span class="line">.   .dockerenv         bin   dev  home  lib64  mnt  proc  run   srv  tmp  var</span><br><span class="line">..  anaconda-post.log  boot  etc  lib   media  opt  root  sbin  sys  usr</span><br><span class="line">[root@92a79e791862 /]# <span class="built_in">ls</span> -a /.dockerenv  </span><br><span class="line">/.dockerenv</span><br></pre></td></tr></table></figure><p>本文参考：</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.mcorazon.top/posts/180be885/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/006.png"><meta itemprop="name" content="Corazon"><meta itemprop="description" content="<font color="#000000">这世界总有黑夜<br>可我们总发着光</font>"> </span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="MCorazon"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/posts/180be885/" class="post-title-link" itemprop="url">【SQL注入】语法示例</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2025-07-09 17:08:19" itemprop="dateCreated datePublished" datetime="2025-07-09T17:08:19+08:00">2025-07-09</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-07-19 16:58:45" itemprop="dateModified" datetime="2025-07-19T16:58:45+08:00">2025-07-19</time></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>449</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>1 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><p>本 SQL 注入小抄包含有用语法的示例，您可以使用这些语法执行各种任务，这些任务在执行 SQL 注入攻击时经常会出现。</p><h2 id="String-concatenation">String concatenation</h2><p>只有一个列时可以将多个字符串连接成一个字符串。</p><table><thead><tr><th>Database type</th><th>Query</th></tr></thead><tbody><tr><td>Oracle</td><td>`‘foo’</td></tr><tr><td>Microsoft</td><td><code>'foo'+'bar'</code></td></tr><tr><td>PostgreSQL</td><td>`‘foo’</td></tr><tr><td>MySQL</td><td><code>'foo' 'bar'</code><br><code>CONCAT('foo','bar')</code></td></tr></tbody></table><h2 id="Substring">Substring</h2><p>您可以从指定长度的指定偏移量中提取字符串的一部分。请注意，偏移索引是以 1 为单位的。以下每个表达式都将返回字符串 ba。</p><table><thead><tr><th>Database type</th><th>Query</th></tr></thead><tbody><tr><td>Oracle</td><td><code>SUBSTR('foobar', 4, 2)</code></td></tr><tr><td>Microsoft</td><td><code>SUBSTRING('foobar', 4, 2)</code></td></tr><tr><td>PostgreSQL</td><td><code>SUBSTRING('foobar', 4, 2)</code></td></tr><tr><td>MySQL</td><td><code>SUBSTRING('foobar', 4, 2)</code></td></tr></tbody></table><h2 id="Comments">Comments</h2><p>可以使用注释来截断查询（也可以用别的），并删除原始查询中跟随您输入的部分。</p><p>本文参考：</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.mcorazon.top/posts/bea7d250/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/006.png"><meta itemprop="name" content="Corazon"><meta itemprop="description" content="<font color="#000000">这世界总有黑夜<br>可我们总发着光</font>"> </span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="MCorazon"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/posts/bea7d250/" class="post-title-link" itemprop="url">【PortSwigger靶场】反序列化</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2025-05-24 19:51:24" itemprop="dateCreated datePublished" datetime="2025-05-24T19:51:24+08:00">2025-05-24</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-05-27 18:14:13" itemprop="dateModified" datetime="2025-05-27T18:14:13+08:00">2025-05-27</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">靶场练习</span></a></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>12k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>11 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="不安全的反序列化">不安全的反序列化</h2><p>在本节中，我们将介绍什么是不安全的反序列化，并描述不安全的反序列化如何可能使网站遭受严重攻击。我们将重点介绍典型场景，并使用 PHP、Ruby 和 Java 反序列化的具体示例演示一些广泛适用的技术。我们还将介绍一些可以避免自己的网站出现不安全反序列化漏洞的方法。</p><h2 id="什么是序列化？">什么是序列化？</h2><p>序列化是将复杂的数据结构（如对象及其字段）转换为 “flatter” 格式的过程，这种格式可以作为连续的字节流发送和接收。数据序列化使以下工作变得更加简单：</p><ul class="lvl-0"><li class="lvl-2"><p>将复杂数据写入进程间内存、文件或数据库</p></li><li class="lvl-2"><p>通过网络、应用程序不同组件之间或 API 调用等方式发送复杂数据</p></li></ul><p>最重要的是，在序列化对象时，其状态也会被持久化。换句话说，对象的属性及其赋值都会被保留下来。</p><h3 id="序列化与反序列化">序列化与反序列化</h3><p>反序列化是将字节流还原为原始对象的全功能复制品的过程，其状态与序列化时完全相同。然后，网站的逻辑就可以与这个反序列化对象交互，就像与其他对象交互一样。</p><p>许多编程语言都为序列化提供本地支持。具体如何序列化对象取决于语言。有些语言将对象序列化为二进制格式，而其他语言则使用不同的字符串格式，其可读性也各不相同。请注意，原始对象的所有属性都会存储在序列化数据流中，包括任何私有字段。要防止某个字段被序列化，必须在类声明中将其明确标记为 “transient” 字段。</p><p>请注意，在使用不同的编程语言时，序列化可能被称为 marshalling（Ruby）或 pickling（Python）。这些术语在此处与 “serialization” 同义。</p><h2 id="什么是不安全的反序列化？">什么是不安全的反序列化？</h2><p>不安全的反序列化是指网站对用户可控数据进行反序列化。这有可能使攻击者操纵序列化对象，从而将有害数据传递到应用程序代码中。</p><p>甚至有可能将序列化后的对象替换为完全不同类的对象。令人担忧的是，网站可用的任何类的对象都会被反序列化和实例化，而不管预期的是哪个类。因此，不安全的反序列化有时被称为 “对象注入 ”漏洞。</p><p>一个意外类的对象可能会导致异常。不过，此时破坏可能已经造成。许多基于反序列化的攻击都是在反序列化完成之前完成的。这意味着，即使网站本身的功能不直接与恶意对象交互，反序列化过程本身也可能发起攻击。因此，逻辑基于强类型语言的网站也容易受到这些技术的攻击。</p><h2 id="不安全的反序列化漏洞是如何产生的？">不安全的反序列化漏洞是如何产生的？</h2><p>不安全的反序列化通常是因为人们普遍缺乏对反序列化用户可控数据的危险性的认识。理想情况下，用户输入根本不应该被反序列化。</p><p>不过，有时网站所有者会认为自己很安全，因为他们对反序列化数据实施了某种形式的额外检查。这种方法往往是无效的，因为几乎不可能实施验证或消毒来应对每一种可能发生的情况。这些检查从根本上说也是有缺陷的，因为它们依赖于在数据被反序列化后对其进行检查，而在许多情况下，这已经太晚了，无法阻止攻击。</p><p>由于通常认为反序列化对象是可信的，因此也可能出现漏洞。特别是在使用二进制序列化格式的语言时，开发人员可能会认为用户无法有效地读取或操作数据。然而，虽然可能需要付出更多努力，但攻击者利用二进制序列化对象的可能性与利用基于字符串格式的对象的可能性一样大。</p><p>现代网站中存在大量依赖关系，这也使得基于反序列化的攻击成为可能。一个典型的网站可能实现了许多不同的库，每个库都有自己的依赖关系。这就形成了一个庞大的类和方法池，很难对其进行安全管理。由于攻击者可以创建任何这些类的实例，因此很难预测在恶意数据上可以调用哪些方法。如果攻击者能够将一长串意想不到的方法调用串联起来，将数据传递到与初始源完全无关的汇中，情况就更是如此。因此，要预测恶意数据流并堵住每个潜在漏洞几乎是不可能的。</p><p>简而言之，可以说不可能安全地反序列化不受信任的输入。</p><h2 id="不安全的反序列化会产生什么影响？">不安全的反序列化会产生什么影响？</h2><p>不安全的反序列化可能会造成非常严重的影响，因为它为大量增加的攻击面提供了一个切入点。它允许攻击者以有害的方式重复使用现有的应用程序代码，导致许多其他漏洞，通常是远程代码执行。</p><p>即使在不可能执行远程代码的情况下，不安全的反序列化也会导致权限升级、任意文件访问和拒绝服务攻击。</p><h2 id="如何利用不安全的反序列化漏洞">如何利用不安全的反序列化漏洞</h2><p>现在您已经熟悉了序列化和反序列化的基础知识，我们可以看看如何利用不安全的反序列化漏洞。</p><h2 id="利用不安全的反序列化漏洞">利用不安全的反序列化漏洞</h2><p>在本节中，我们将以 PHP、Ruby 和 Java 反序列化为例，教您如何利用一些常见情况。我们希望展示利用不安全的反序列化实际上比许多人想象的要容易得多。如果您能够使用预构建的小工具链，甚至在黑盒测试中可以做到这一点。</p><p>我们还将指导您创建自己的基于反序列化的高严重性攻击。虽然这些攻击通常需要源代码访问权限，但一旦理解了基本概念，学习起来也会比想象中容易。我们将特别介绍以下主题：</p><ul class="lvl-0"><li class="lvl-2"><p>如何识别不安全的反序列化 LABS</p></li><li class="lvl-2"><p>修改网站期望的序列化对象 LABS</p></li><li class="lvl-2"><p>向危险的网站功能传递恶意数据 LABS</p></li><li class="lvl-2"><p>注入任意对象类型</p></li><li class="lvl-2"><p>串联方法调用以控制进入危险水槽小工具的数据流 LABS</p></li><li class="lvl-2"><p>手动创建自己的高级漏洞利用程序 LABS</p></li><li class="lvl-2"><p>PHAR 反序列化</p></li></ul><blockquote><p><strong>Note</strong></p><p>尽管许多实验和示例都基于 PHP，但大多数开发技术对其他语言也同样适用。</p></blockquote><h3 id="如何识别不安全的反序列化">如何识别不安全的反序列化</h3><p>不管是白盒测试还是黑盒测试，识别不安全的反序列化都相对简单。</p><p>在审计过程中，你应该查看所有传入网站的数据，并尝试识别任何看起来像序列化数据的东西。如果了解不同语言使用的格式，序列化数据就能比较容易地识别出来。在本节中，我们将展示 PHP 和 Java 序列化的示例。一旦识别出序列化数据，就可以测试是否能够控制它。</p><blockquote><p><strong>Tip</strong></p><p>对于 Burp Suite Professional 的用户，Burp Scanner 会自动标记任何看起来包含序列化对象的 HTTP 消息。</p></blockquote><h3 id="PHP-序列化格式">PHP 序列化格式</h3><p>PHP 使用的大多是人类可读的字符串格式，字母代表数据类型，数字代表每个条目的长度。例如，用户对象的属性为</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$user</span>-&gt;name = <span class="string">&quot;carlos&quot;</span>;</span><br><span class="line"><span class="variable">$user</span>-&gt;isLoggedIn = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure><p>序列化后，该对象的外观可能如下所示：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">O</span>:<span class="number">4</span>:<span class="string">&quot;User&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>:s:<span class="number">6</span>:<span class="string">&quot;carlos&quot;</span>;s:<span class="number">10</span>:<span class="string">&quot;isLoggedIn&quot;</span>:b:<span class="number">1</span>;&#125;</span><br></pre></td></tr></table></figure><p>这可以解释为：</p><ul class="lvl-0"><li class="lvl-2"><p><code>O:4: &quot;User&quot;</code> - 具有 4 个字符类名 <code>&quot;User&quot;</code> 的对象</p></li><li class="lvl-2"><p><code>2</code> - 该对象有 2 个属性</p></li><li class="lvl-2"><p><code>s:4: &quot;name&quot;</code> - 第一个属性的键是 4 个字符的字符串 <code>“name”</code>。</p></li><li class="lvl-2"><p><code>s:6: &quot;carlos&quot;</code> - 第一个属性的值是 6 个字符的字符串 <code>“carlos”</code>。</p></li><li class="lvl-2"><p><code>s:10: &quot;isLoggedIn&quot;</code> - 第二个属性的键是 10 个字符的字符串 “isLoggedIn”。</p></li><li class="lvl-2"><p><code>b:1</code> - 第二个属性的值是布尔值 <code>true</code></p></li></ul><p>PHP 序列化的本地方法是 <code>serialize()</code>和 <code>unserialize()</code>。如果可以访问源代码，就应该先在代码中查找 <code>unserialize()</code>，然后进一步研究。</p><h3 id="Java-序列化格式">Java 序列化格式</h3><p>有些语言（如 Java）使用二进制序列化格式。这种格式更难读取，但如果知道如何识别一些蛛丝马迹，还是可以识别序列化数据的。例如，序列化的 Java 对象总是以相同的字节开始，在十六进制中编码为 <code>aced</code>，在 Base64 中编码为 <code>rO0</code>。</p><p>任何实现了 <code>java.io.Serializable</code> 接口的类都可以被序列化和反序列化。如果您可以访问源代码，请注意任何使用 <code>readObject()</code> 方法的代码，该方法用于从 <code>InputStream</code> 中读取和反序列化数据。</p><h3 id="操作序列化对象">操作序列化对象</h3><p>利用某些反序列化漏洞就像更改序列化对象中的一个属性一样简单。由于对象状态是持久化的，因此可以通过研究序列化数据来识别和编辑有趣的属性值。然后，您就可以通过网站的反序列化过程将恶意对象传入网站。这是基本反序列化漏洞利用的第一步。</p><p>一般来说，在操作序列化对象时有两种方法。一种是直接编辑字节流形式的对象，另一种是用相应的语言编写简短的脚本，自己创建新对象并将其序列化。在处理二进制序列化格式时，后一种方法通常更为简便。</p><h4 id="修改对象属性">修改对象属性</h4><p>在篡改数据时，只要攻击者保留了一个有效的序列化对象，反序列化过程就会创建一个带有修改后属性值的服务器端对象。</p><p>举个简单的例子，一个网站使用序列化的 <code>User</code> 对象在 cookie 中存储用户会话数据。如果攻击者在 HTTP 请求中发现了这个序列化对象，他们可能会对其进行解码，发现以下字节流：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">O</span>:<span class="number">4</span>:<span class="string">&quot;User&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;carlos&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;isAdmin&quot;</span>;b:<span class="number">0</span>;&#125;</span><br></pre></td></tr></table></figure><p><code>isAdmin</code> 属性是一个明显的关注点。攻击者只需将该属性的布尔值改为 <code>1</code>（true），重新编码对象，然后用修改后的值覆盖当前 cookie 即可。单独来看，这不会产生任何影响。但是，假设网站使用此 cookie 来检查当前用户是否有访问某些管理功能的权限：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$user</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_COOKIE</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$user</span>-&gt;isAdmin === <span class="literal">true</span>) &#123;</span><br><span class="line"><span class="comment">// allow access to admin interface</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这段有漏洞的代码会根据 cookie 中的数据（包括攻击者修改过的 <code>isAdmin</code> 属性）实例化一个<code>User</code>对象。在任何时候都不会检查序列化对象的真实性。然后，这些数据会被传递到条件语句中，在这种情况下，就可以轻松实现权限升级。</p><p>这种简单的情况在实际应用中并不常见。不过，以这种方式编辑属性值，展示了获取不安全反序列化所暴露的大量攻击面的第一步。</p><h4 id="Lab：修改序列化对象">Lab：修改序列化对象</h4><p>本实验使用了基于序列化的会话机制，因此存在权限升级漏洞。要解决该实验问题，请编辑会话 cookie 中的序列化对象，利用此漏洞获得管理权限。然后删除用户 carlos。</p><ul class="lvl-0"><li class="lvl-2"><p>使用自己的凭据登录。请注意，登录后的 <code>GET /my-account</code> 请求包含一个会话 cookie，它似乎是 URL 和 Base64 编码的。</p></li><li class="lvl-2"><p>使用 Burp 的 Inspector 面板研究请求的解码形式。请注意，cookie 实际上是一个序列化的 PHP 对象。admin 属性包含 b:0，表示布尔值 false。将此请求发送到 Burp Repeater。</p></li><li class="lvl-2"><p>在 Burp Repeater 中，使用检查器再次检查 cookie，并将 admin 属性的值更改为 b:1。点击 “应用更改”。修改后的对象将自动重新编码并更新到请求中。</p></li><li class="lvl-2"><p>发送请求。请注意，响应中现在包含了一个指向 /admin 管理面板的链接，表明您已使用管理员权限访问了该页面。</p></li><li class="lvl-2"><p>将请求路径改为 /admin，然后重新发送。注意 /admin 页面包含删除特定用户账户的链接。</p></li><li class="lvl-2"><p>将请求路径更改为 /admin/delete?username=carlos，然后发送请求以解决实验室问题。</p></li></ul><h4 id="修改数据类型">修改数据类型</h4><p>我们已经看到了如何修改序列化对象中的属性值，但也有可能提供意想不到的数据类型。</p><p>由于在比较不同数据类型时使用了松散比较运算符 (==)，基于 PHP 的逻辑特别容易受到这种操作的影响。例如，如果在整数和字符串之间进行松散比较，PHP 会尝试将字符串转换为整数，这意味着 5 == “5” 的值为 true。</p><h2 id="如何防止不安全的反序列化漏洞">如何防止不安全的反序列化漏洞</h2><p>一般来说，除非绝对必要，否则应避免对用户输入进行反序列化。在许多情况下，反序列化可能带来的高严重性漏洞，以及防范这些漏洞的难度，都超过了反序列化的好处。</p><p>由于在比较不同数据类型时使用了松散比较运算符 (==)，基于 PHP 的逻辑特别容易受到这种操作的影响。例如，如果在整数和字符串之间进行松散比较，PHP 会尝试将字符串转换为整数，这意味着 5 == “5” 的值为 true。</p><p>由于在比较不同数据类型时使用了松散比较运算符 (<code>==</code>)，基于 PHP 的逻辑特别容易受到这种操作的影响。例如，如果在整数和字符串之间进行松散比较，PHP 会尝试将字符串转换为整数，这意味着 <code>5 == “5”</code> 的值为 <code>true</code>。</p><p>不同寻常的是，这也适用于任何以数字开头的字母数字字符串。在这种情况下，PHP 将根据开头的数字有效地将整个字符串转换为整数值。字符串的其余部分将被完全忽略。因此，<code>5 == &quot;5 of something&quot;</code> 实际上被视为 <code>5 == 5</code>。</p><p>同样，在 PHP 7.x 及更早版本中，比较 <code>0 == &quot;Example string&quot;</code> 的结果为 <code>true</code>，因为 PHP 将整个字符串视为整数 <code>0</code>。</p><p>考虑将这种松散的比较运算符与来自反序列化对象的用户可控数据结合使用的情况。这有可能导致危险的逻辑缺陷。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$login</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_COOKIE</span>)</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$login</span>[<span class="string">&#x27;password&#x27;</span>] == <span class="variable">$password</span>) &#123;</span><br><span class="line"><span class="comment">// log in successfully</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>假设攻击者修改了密码属性，使其包含整数 <code>0</code>，而不是预期的字符串。只要存储的密码不是以数字开头，该条件就会始终返回 <code>true</code>，从而实现身份验证绕过。请注意，这只是因为反序列化保留了数据类型。如果代码直接从请求中获取密码，<code>0</code> 将被转换为字符串，条件将返回 <code>false</code>。</p><blockquote><p><strong>Note</strong></p><p>在 PHP 8 及以后的版本中，0 == “Example string ”比较结果为 false，因为在比较过程中字符串不再隐式转换为 0。因此，在这些版本的 PHP 中无法使用此漏洞。</p><p>比较以数字开头的字母数字字符串的行为在 PHP 8 中保持不变。因此，5 == <code>“5 of something ”</code>仍被视为 <code>5 == 5</code>。</p></blockquote><p>请注意，在修改任何序列化对象格式中的数据类型时，一定要记得更新序列化数据中的任何类型标签和长度指示符。否则，序列化对象将被损坏，无法进行反序列化。</p><h4 id="Lab：-修改序列化数据类型">Lab： 修改序列化数据类型</h4><p>本实验使用了基于序列化的会话机制，因此容易发生身份验证绕过。要解决该实验问题，请编辑会话 cookie 中的序列化对象，以访问<code>administrator</code>账户。然后删除用户 <code>carlos</code>。</p><ul class="lvl-0"><li class="lvl-2"><p>使用自己的凭据登录。在 Burp 中，打开登录后的 <code>GET /my-account</code> 请求，并使用检查器检查会话 cookie，以显示序列化的 PHP 对象。将此请求发送到 Burp Repeater。</p></li><li class="lvl-2"><p>在 Burp Repeater 中，使用检查器面板对会话 cookie 进行如下修改：</p><ul class="lvl-2"><li class="lvl-4"><p>将用户名属性的长度更新为 13。</p></li><li class="lvl-4"><p>将用户名改为管理员。</p></li><li class="lvl-4"><p>将访问令牌更改为整数 0。 由于这不再是字符串，因此还需要删除值周围的双引号。</p></li><li class="lvl-4"><p>将 s 替换为 i，更新访问令牌的数据类型标签。</p></li></ul></li></ul><p>结果应该是这样的:</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">O</span>:<span class="number">4</span>:<span class="string">&quot;User&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">13</span>:<span class="string">&quot;administrator&quot;</span>;s:<span class="number">12</span>:<span class="string">&quot;access_token&quot;</span>;i:<span class="number">0</span>;&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>单击 “应用更改”。修改后的对象将自动重新编码并更新到请求中。</p></li><li class="lvl-2"><p>发送请求。请注意，响应中现在包含一个指向 <code>/admin</code> 管理面板的链接，表明您已成功以管理员用户身份访问该页面。</p></li><li class="lvl-2"><p>将请求路径改为 <code>/admin</code>，然后重新发送。注意<code>/admin</code> 页面包含删除特定用户账户的链接。</p></li><li class="lvl-2"><p>将请求路径更改为<code>/admin/delete?username=carlos</code>，然后发送请求以解决实验室问题。</p></li></ul><p>在直接处理二进制格式时，我们建议使用 BApp 商店提供的 Hackvertor 扩展。使用 Hackvertor，你可以将序列化数据修改为字符串，它会自动更新二进制数据，并相应调整偏移量。这样可以节省大量的手动操作。</p><h2 id="使用应用程序功能">使用应用程序功能</h2><p>除了简单地检查属性值外，网站功能还可能对来自反序列化对象的数据执行危险操作。在这种情况下，您可以利用不安全的反序列化传递非预期数据，并利用相关功能进行破坏。</p><p>例如，作为网站 “删除用户 ”功能的一部分，用户的个人资料图片是通过访问 <code>$user-&gt;image_location</code> 属性中的文件路径来删除的。如果该 <code>$user</code> 是通过序列化对象创建的，攻击者就可以通过将 <code>image_location</code> 设置为任意文件路径的修改后传入来利用这一漏洞。删除自己的用户账户后，也会删除这个任意文件。</p><h4 id="Lab：-使用应用程序功能利用不安全的反序列化">Lab： 使用应用程序功能利用不安全的反序列化</h4><p>本实验室使用基于序列化的会话机制。某个功能会对序列化对象中提供的数据调用一个危险的方法。要解决这个实验问题，请编辑会话 cookie 中的序列化对象，并用它删除<code>Carlos</code>主目录中的 <code>morale.txt</code> 文件。</p><ol><li class="lvl-3"><p>登录自己的账户。在 “我的账户 ”页面，注意到有删除账户的选项，可向 /my-account/delete 发送 POST 请求。</p></li><li class="lvl-3"><p>向 Burp Repeater 发送包含会话 cookie 的请求。</p></li><li class="lvl-3"><p>在 Burp Repeater 中，使用检查器面板研究会话 cookie。注意到序列化对象有一个 avatar_link 属性，其中包含头像的文件路径。</p></li><li class="lvl-3"><p>编辑序列化数据，使 avatar_link 指向 /home/carlos/morale.txt。记住要更新长度指示符。修改后的属性应如下所示：</p></li></ol><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">s</span>:<span class="number">11</span>:<span class="string">&quot;avatar_link&quot;</span>;s:<span class="number">23</span>:<span class="string">&quot;/home/carlos/morale.txt&quot;</span></span><br></pre></td></tr></table></figure><ol start="5"><li class="lvl-3"><p>点击 “应用更改”。修改后的对象将自动重新编码并更新到请求中。</p></li><li class="lvl-3"><p>将请求行改为 POST /my-account/delete 并发送请求。您的账户将被删除，同时删除的还有卡洛斯的 morale.txt 文件。</p></li></ol><p>这个示例依赖于攻击者通过用户可访问的功能手动调用危险方法。但是，如果利用漏洞自动将数据传递到危险方法中，不安全的反序列化就会变得更加有趣。使用 “magic methods ”可以实现这一点。</p><h2 id="Magic-methods">Magic methods</h2><p>魔法方法是无需显式调用的方法的特殊子集。相反，每当发生特定事件或情况时，它们就会被自动调用。魔法方法是各种语言中面向对象编程的常见特征。有时会在方法名称的前缀或周围加上双引号来表示它们。</p><p>开发人员可以在类中添加魔法方法，以便预先确定在相应事件或场景发生时应执行哪些代码。调用魔法方法的具体时间和原因因方法而异。PHP 中最常见的例子之一是 <code>__construct()</code>，它在类的对象实例化时被调用，类似于 Python 的 <code>__init__</code> 。通常，构造函数魔法方法包含初始化实例属性的代码。不过，开发人员可以自定义魔法方法，以执行他们想要的任何代码。</p><p>魔法方法被广泛使用，其本身并不代表漏洞。但是，当执行这些方法的代码处理攻击者可控制的数据（例如来自反序列化对象的数据）时，它们就会变得危险。攻击者可以利用这一点，在满足相应条件时自动调用反序列化数据上的方法。</p><p>最重要的是，有些语言在反序列化过程中会自动调用魔法方法。例如，PHP 的 <code>unserialize()</code> 方法会查找并调用对象的 <code>__wakeup()</code> 魔法方法。</p><p>在 Java 反序列化中，<code>ObjectInputStream.readObject()</code> 方法也是如此，该方法用于从初始字节流中读取数据，本质上类似于 “重新初始化 ”序列化对象的构造函数。不过，可序列化类也可以按如下方式声明自己的 <code>readObject()</code> 方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(ObjectInputStream in)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// implementation</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以这种方式声明的 <code>readObject()</code> 方法就像一个魔法方法，在反序列化过程中会被调用。这样，类就能更紧密地控制自己字段的反序列化。</p><p>你应该密切关注任何包含这类神奇方法的类。它们允许你在对象完全反序列化之前将数据从序列化对象传递到网站代码中。这是创建更高级漏洞的起点。</p><h2 id="注入任意对象">注入任意对象</h2><p>正如我们所见，偶尔可以通过简单编辑网站提供的对象来利用不安全的反序列化。然而，注入任意对象类型会带来更多可能性。</p><p>在面向对象编程中，对象可用的方法由其类决定。因此，如果攻击者能操纵作为序列化数据传入的对象类别，就能影响反序列化后甚至反序列化过程中执行的代码。</p><p>反序列化方法通常不会检查它们正在反序列化的对象。这意味着你可以传入网站可用的任何可序列化类的对象，而该对象将被反序列化。这实际上允许攻击者创建任意类的实例。这个对象不是预期的类并不重要。意外的对象类型可能会导致应用程序逻辑出现异常，但恶意对象届时已经实例化了。</p><p>如果攻击者可以访问源代码，他们就可以详细研究所有可用的类。要构建一个简单的漏洞，攻击者可以查找包含反序列化魔法方法的类，然后检查其中是否有对可控数据执行危险操作的类。然后，攻击者就可以传入该类的序列化对象，使用其魔法方法进行攻击。</p><h4 id="Lab：-PHP-中的任意对象注入">Lab： PHP 中的任意对象注入</h4><p>本实验使用基于序列化的会话机制，因此容易受到任意对象注入的攻击。要解决该实验问题，请创建并注入一个恶意序列化对象，以删除 Carlos home 目录中的 morale.txt 文件。您需要获得源代码访问权限才能解决本实验。</p><ol><li class="lvl-3"><p>登录自己的账户，注意会话 cookie 包含一个序列化的 PHP 对象。</p></li><li class="lvl-3"><p>在网站地图中，注意到网站引用了 <code>/libs/CustomTemplate.php</code> 文件。右键单击该文件，选择 “发送到中继器”。</p></li></ol><p><img src="/images/loading.jpeg" data-original="/posts/bea7d250//image-20250527163121200.png" alt="image-20250527163121200"></p><ol start="3"><li class="lvl-3"><p>在 Burp Repeater 中，注意在请求行的文件名后添加一个斜杠 (<code>~</code>) 就能读取源代码。</p></li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomTemplate</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$template_file_path</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$lock_file_path</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$template_file_path</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;template_file_path = <span class="variable">$template_file_path</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;lock_file_path = <span class="variable">$template_file_path</span> . <span class="string">&quot;.lock&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">isTemplateLocked</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">file_exists</span>(<span class="variable">$this</span>-&gt;lock_file_path);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getTemplate</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;template_file_path);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">saveTemplate</span>(<span class="params"><span class="variable">$template</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">isTemplateLocked</span>()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;lock_file_path, <span class="string">&quot;&quot;</span>) === <span class="literal">false</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;Could not write to &quot;</span> . <span class="variable language_">$this</span>-&gt;lock_file_path);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;template_file_path, <span class="variable">$template</span>) === <span class="literal">false</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;Could not write to &quot;</span> . <span class="variable language_">$this</span>-&gt;template_file_path);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// Carlos thought this would be a good idea</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$this</span>-&gt;lock_file_path)) &#123;</span><br><span class="line">            <span class="title function_ invoke__">unlink</span>(<span class="variable">$this</span>-&gt;lock_file_path);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><ol start="4"><li class="lvl-3"><p>在源代码中，请注意 <code>CustomTemplate</code> 类包含 <code>__destruct()</code> 魔法方法。这将调用 <code>lock_file_path</code> 属性上的 <code>unlink()</code> 方法，从而删除该路径上的文件。</p></li><li class="lvl-3"><p>在 Burp 解码器中，使用序列化 PHP 数据的正确语法创建一个 <code>CustomTemplate</code> 对象，并将 <code>lock_file_path</code> 属性设置为 <code>/home/carlos/morale.txt</code>。确保使用正确的数据类型标签和长度指示符。最终对象应如下所示：</p></li></ol><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">O</span>:<span class="number">14</span>:<span class="string">&quot;CustomTemplate&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">14</span>:<span class="string">&quot;lock_file_path&quot;</span>;s:<span class="number">23</span>:<span class="string">&quot;/home/carlos/morale.txt&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><ol start="6"><li class="lvl-3"><p>对该对象进行 Base64 和 URL 编码，并将其保存到剪贴板。</p></li><li class="lvl-3"><p>向 Burp Repeater 发送包含会话 cookie 的请求。</p></li><li class="lvl-3"><p>在 Burp Repeater 中，用剪贴板中修改后的 cookie 替换会话 cookie。</p></li><li class="lvl-3"><p>发送请求。魔法方法 <code>__destruct()</code> 会被自动调用，并删除 Carlos 的文件。</p></li></ol><p>包含这些反序列化魔法方法的类还可用于发起更复杂的攻击，其中涉及一长串方法调用，即所谓的 “小工具链”。</p><h2 id="小工具链">小工具链</h2><p>小工具 &quot;是应用程序中存在的代码片段，可帮助攻击者实现特定目标。单个小工具可能不会直接对用户输入进行任何有害操作。但是，攻击者的目标可能只是调用一个方法，将用户输入传递到另一个小工具中。通过以这种方式将多个小工具串联在一起，攻击者就有可能将其输入传递到一个危险的 “下沉小工具 ”中，从而造成最大的破坏。</p><p>重要的是要明白，与其他一些类型的漏洞利用不同，小工具链不是攻击者构建的链式方法的有效payload。所有代码都已存在于网站上。攻击者唯一能控制的是传入小工具链的数据。这通常是通过在反序列化过程中调用的魔法方法来实现的，有时也称为 “启动小工具”。</p><p>在外网，许多不安全的反序列化漏洞只能通过使用小工具链来利用。这有时可能是简单的一步或两步链，但构建高严重性攻击可能需要更复杂的对象实例化和方法调用序列。因此，能够构建小工具链是成功利用不安全反序列化的关键因素之一。</p><h3 id="使用预制小工具链">使用预制小工具链</h3><p>手动识别小工具链可能是一个相当艰巨的过程，而且在没有源代码访问权限的情况下几乎是不可能的。幸运的是，有几种使用预建小工具链的方法可以先试试。</p><p>有几种工具可以提供一系列预先发现的链，这些链已在其他网站上被成功利用。即使您没有访问源代码的权限，也可以使用这些工具来识别和利用不安全的反序列化漏洞，所需的工作量相对较小。之所以能采用这种方法，是因为广泛使用了包含可利用小工具链的库。例如，如果 Java 的 Apache Commons Collections 库中的小工具链可以在一个网站上被利用，那么任何其他实现该库的网站也可以使用相同的小工具链进行利用。</p><h4 id="ysoserial">ysoserial</h4><p>ysoserial &quot;就是这样一个 Java 反序列化工具。它可以让你从提供的小工具链中选择一个你认为目标应用程序正在使用的库，然后传入你想执行的命令。然后，它会根据所选链创建一个合适的序列化对象。这仍然需要一定的尝试和错误，但比手动构建自己的小工具链要省力得多。</p><blockquote><p><strong>Note</strong><br>在 Java 16 及以上版本中，您需要设置一系列命令行参数，以便 Java 运行 ysoserial。例如</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">java -jar ysoserial-all.jar \</span><br><span class="line">   --add-opens=java.xml/com.sun.org.apache.xalan.internal.xsltc.trax=ALL-UNNAMED \</span><br><span class="line">   --add-opens=java.xml/com.sun.org.apache.xalan.internal.xsltc.runtime=ALL-UNNAMED \</span><br><span class="line">   --add-opens=java.base/java.net=ALL-UNNAMED \</span><br><span class="line">   --add-opens=java.base/java.util=ALL-UNNAMED \</span><br><span class="line">   [payload] <span class="string">&#x27;[command]&#x27;</span></span><br></pre></td></tr></table></figure></blockquote><h4 id="Lab：使用Apache-Commons利用Java-反序列化">Lab：使用Apache Commons利用Java 反序列化</h4><p>本实验室使用基于序列化的会话机制，并加载 Apache Commons Collections 库。虽然您没有源代码访问权限，但仍可使用预构建的小工具链来利用本实验室。</p><p>要解决该实验室问题，请使用第三方工具生成一个包含远程代码执行有效载荷的恶意序列化对象。然后，将此对象传入网站，删除卡洛斯主目录中的 <code>morale.txt</code> 文件。</p><p>本文参考：</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><nav class="pagination"><a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a></nav></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Corazon" src="/images/006.png"><p class="site-author-name" itemprop="name">Corazon</p><div class="site-description" itemprop="description"><font color="#000000">这世界总有黑夜<br>可我们总发着光</font></div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">32</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">6</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">13</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/Corazon-hacker" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Corazon-hacker" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a></span></div><div class="links-of-blogroll motion-element"><div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="https://www.runoob.com/" title="https:&#x2F;&#x2F;www.runoob.com&#x2F;" rel="noopener" target="_blank">菜鸟教程</a></li><li class="links-of-blogroll-item"><a href="http://c.biancheng.net/sitemap/" title="http:&#x2F;&#x2F;c.biancheng.net&#x2F;sitemap&#x2F;" rel="noopener" target="_blank">C语言中文网</a></li><li class="links-of-blogroll-item"><a href="https://csdiy.wiki/" title="https:&#x2F;&#x2F;csdiy.wiki&#x2F;" rel="noopener" target="_blank">CS自学指南</a></li><li class="links-of-blogroll-item"><a href="https://www.r2coding.com/#/" title="https:&#x2F;&#x2F;www.r2coding.com&#x2F;#&#x2F;" rel="noopener" target="_blank">Road To Coding</a></li><li class="links-of-blogroll-item"><a href="https://hackway.org/docs/cs/intro" title="https:&#x2F;&#x2F;hackway.org&#x2F;docs&#x2F;cs&#x2F;intro" rel="noopener" target="_blank">计算机专业学习路线</a></li></ul></div></div><div class="back-to-top motion-element"><i class="fa fa-arrow-up"></i> <span>0%</span></div><script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script><script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script><div class="widget-wrap"><h3 class="widget-title">标签云</h3><div id="myCanvasContainer" class="widget tagcloud"><canvas width="250" height="250" id="resCanvas"><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/" rel="tag">Hexo</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MYSQL/" rel="tag">MYSQL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PortSwigger%E9%9D%B6%E5%9C%BA/" rel="tag">PortSwigger靶场</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL%E6%B3%A8%E5%85%A5/" rel="tag">SQL注入</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Typora/" rel="tag">Typora</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XSS/" rel="tag">XSS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqlmap/" rel="tag">sqlmap</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/upload-lab%E9%9D%B6%E5%9C%BA/" rel="tag">upload-lab靶场</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" rel="tag">反序列化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" rel="tag">文件上传</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B7%AF%E5%BE%84%E9%81%8D%E5%8E%86/" rel="tag">路径遍历</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%B6%E5%9C%BA/" rel="tag">靶场</a><span class="tag-list-count">1</span></li></ul></canvas></div></div></div></aside><div id="sidebar-dimmer"></div></div></main></div><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2025</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Corazon</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-chart-area"></i> </span><span title="站点总字数">261k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span title="站点阅读时长">3:57</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i> </span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span> </span></span><span class="post-meta-divider">|</span> <span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer><script color="0,0,255" opacity="1" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/code-unfold.js"></script><script src="/js/local-search.js"></script><script>if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }</script><script>NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : true,
      appId      : '02iDSwDgb06k5K8yx5oSD85t-gzGzoHsz',
      appKey     : 'eA8vZdwW4UasH3SiNapGvXh5',
      placeholder: "你是我一生只会遇见一次的惊喜 ...",
      avatar     : 'monsterid',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : 'https://02idswdg.lc-cn-n1-shared.com'
    });
  }, window.Valine);
});</script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><link href="https://cdn.bootcss.com/gitalk/1.4.0/gitalk.min.css" rel="stylesheet"><script src="https://cdn.bootcss.com/gitalk/1.4.0/gitalk.min.js"></script><script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script><script type="text/javascript">var gitalk = new Gitalk({
    clientID: '',
    clientSecret: '',
    repo: 'Corazon-hacker.github.io',
    owner: '',
    admin: [''],
    id: md5(location.pathname),   // ISSUE：location.href 限制50个字符 (应该是Issue 内容存数据库的标识， 具体在页面上无感)
    labels: ''.split(',').filter(l => l),  // 需要的 labels需要一个数组，否则会报错
    perPage: ,
    pagerDirection: '',
    createIssueManually: ,
    distractionFreeMode: 
  })
  gitalk.render('gitalk-container')</script><style>[bg-lazy]{background-image:none!important;background-color:#eee!important}</style><script>window.imageLazyLoadSetting={isSPA:!1,preloadRatio:1,processImages:null}</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})})</script><script>(r=>{r.imageLazyLoadSetting.processImages=t;var a=r.imageLazyLoadSetting.isSPA,o=r.imageLazyLoadSetting.preloadRatio||1,d=i();function i(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(t){(a||t)&&(d=i());for(var e,n=0;n<d.length;n++)0<=(e=(e=d[n]).getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(r.innerHeight*o||document.documentElement.clientHeight*o)&&(()=>{var t,e,a,o,i=d[n];e=function(){d=d.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).dataset.loaded||(t.hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(a=new Image,o=t.getAttribute("data-original"),a.onload=function(){t.src=o,t.removeAttribute("data-original"),t.setAttribute("data-loaded",!0),e&&e()},a.onerror=function(){t.removeAttribute("data-original"),t.setAttribute("data-loaded",!1),t.src=o},t.src!==o&&(a.src=o)))})()}function e(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",e),r.addEventListener("resize",e),r.addEventListener("orientationchange",e)})(this);</script></body></html>